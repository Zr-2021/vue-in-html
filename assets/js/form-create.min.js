/*!
 * @form-create/element-ui v2.5.31
 * (c) 2018-2023 xaboy
 * Github https://github.com/xaboy/form-create
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vue")):"function"==typeof define&&define.amd?define(["exports","vue"],t):t((e=e||self).formCreate={},e.Vue)}(this,function(e,t){"use strict";function n(){return(n=Object.assign||function(e){for(var t,n=1;n<arguments.length;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)}t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var i=["attrs","props","domProps"],r=["class","style","directives"],o=["on","nativeOn"],a=function(e,t){return function(){e&&e.apply(this,arguments),t&&t.apply(this,arguments)}},u=function(e){return e.reduce(function(e,t){for(var u in t)if(e[u])if(-1!==i.indexOf(u))e[u]=n({},e[u],t[u]);else if(-1!==r.indexOf(u)){var c=e[u]instanceof Array?e[u]:[e[u]],s=t[u]instanceof Array?t[u]:[t[u]];e[u]=c.concat(s)}else if(-1!==o.indexOf(u))for(var l in t[u])if(e[u][l]){var f=e[u][l]instanceof Array?e[u][l]:[e[u][l]],d=t[u][l]instanceof Array?t[u][l]:[t[u][l]];e[u][l]=f.concat(d)}else e[u][l]=t[u][l];else if("hook"==u)for(var p in t[u])e[u][p]=e[u][p]?a(e[u][p],t[u][p]):t[u][p];else e[u]=t[u];else e[u]=t[u];return e},{})};function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){s(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,i=d(e);if(t){var r=d(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return h(this,n)}}function v(e){return function(e){if(Array.isArray(e))return y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function g(e,t){return Object.keys(e).reduce(function(n,i){return t&&-1!==t.indexOf(i)||n.push(e[i]),n},[])}var b={name:"fcCheckbox",props:{formCreateInject:{type:Object,required:!0},value:{type:Array,default:function(){return[]}},type:String},watch:{"formCreateInject.options":{handler:function(){this.update()},deep:!0},value:function(){this.update()}},data:function(){return{trueValue:[]}},methods:{options:function(){var e=this.formCreateInject.options;return Array.isArray(e)?e:[]},onInput:function(e){this.$emit("input",this.options().filter(function(t){return-1!==e.indexOf(t.label)}).map(function(e){return e.value}).filter(function(e){return void 0!==e}))},update:function(){var e=Array.isArray(this.value)?this.value:[this.value];this.trueValue=this.options().filter(function(t){return-1!==e.indexOf(t.value)}).map(function(e){return e.label})}},created:function(){this.update()},render:function(){var e=this,t=arguments[0];return t("ElCheckboxGroup",u([{},this.formCreateInject.prop,{},{props:{value:this.trueValue}},{on:{input:this.onInput}}]),[this.options().map(function(n,i){var r=f({},n),o="button"===e.type?"ElCheckboxButton":"ElCheckbox";return delete r.value,t(o,u([{},{props:r},{key:o+i+"-"+n.value}]))}),g(this.$slots)])}};function $(e){return Array.isArray(e)?e:[null,void 0,""].indexOf(e)>-1?[]:[e]}function k(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===n&&i.firstChild?i.insertBefore(r,i.firstChild):i.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}}k("._fc-frame .fc-files img {\n    width: 100%;\n    height: 100%;\n    display: inline-block;\n    vertical-align: top;\n}\n\n._fc-frame .fc-upload-btn {\n    border: 1px dashed #c0ccda;\n    cursor: pointer;\n}\n\n._fc-frame .fc-upload-cover {\n    opacity: 0;\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    background: rgba(0, 0, 0, .6);\n    -webkit-transition: opacity .3s;\n    -o-transition: opacity .3s;\n    transition: opacity .3s;\n}\n\n._fc-frame .fc-upload-cover i {\n    color: #fff;\n    font-size: 20px;\n    cursor: pointer;\n    margin: 0 2px;\n}\n\n._fc-frame .fc-files:hover .fc-upload-cover {\n    opacity: 1;\n}\n\n._fc-frame .el-upload {\n    display: block;\n}\n\n._fc-frame .fc-upload-btn, .fc-files {\n    display: inline-block;\n    width: 58px;\n    height: 58px;\n    text-align: center;\n    line-height: 58px;\n    border: 1px solid #c0ccda;\n    border-radius: 4px;\n    overflow: hidden;\n    background: #fff;\n    position: relative;\n    -webkit-box-shadow: 2px 2px 5px rgba(0, 0, 0, .1);\n    box-shadow: 2px 2px 5px rgba(0, 0, 0, .1);\n    margin-right: 4px;\n    -webkit-box-sizing: border-box;\n    box-sizing: border-box;\n}\n");var x={name:"fcFrame",props:{formCreateInject:{type:Object,required:!0},type:{type:String,default:"input"},field:String,helper:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},src:{type:String,required:!0},icon:{type:String,default:"el-icon-upload2"},width:{type:String,default:"500px"},height:{type:String,default:"370px"},maxLength:{type:Number,default:0},okBtnText:{type:String,default:"确定"},closeBtnText:{type:String,default:"关闭"},modalTitle:String,handleIcon:{type:[String,Boolean],default:void 0},title:String,allowRemove:{type:Boolean,default:!0},onOpen:{type:Function,default:function(){}},onOk:{type:Function,default:function(){}},onCancel:{type:Function,default:function(){}},onLoad:{type:Function,default:function(){}},onBeforeRemove:{type:Function,default:function(){}},onRemove:{type:Function,default:function(){}},onHandle:{type:Function,default:function(e){this.previewImage=this.getSrc(e),this.previewVisible=!0}},modal:{type:Object,default:function(){return{}}},srcKey:{type:[String,Number]},value:[Array,String,Number,Object],previewMask:void 0,footer:{type:Boolean,default:!0},reload:{type:Boolean,default:!0},closeBtn:{type:Boolean,default:!0},okBtn:{type:Boolean,default:!0}},data:function(){return{fileList:$(this.value),previewVisible:!1,frameVisible:!1,previewImage:""}},watch:{value:function(e){this.fileList=$(e)},fileList:function(e){var t=1===this.maxLength?e[0]||"":e;this.$emit("input",t),this.$emit("change",t)},src:function(e){this.modalVm&&(this.modalVm.src=e)}},methods:{key:function(e){return e},closeModel:function(e){this.$emit(e?"$close":"$ok"),this.reload&&(this.$off("$ok"),this.$off("$close")),this.frameVisible=!1},handleCancel:function(){this.previewVisible=!1},showModel:function(){this.disabled||!1===this.onOpen()||(this.frameVisible=!0)},makeInput:function(){var e=this,t=this.$createElement,n={type:"text",value:this.fileList.map(function(t){return e.getSrc(t)}).toString(),readonly:!0};return t("ElInput",u([{},{props:n},{key:this.key("input")}]),[this.fileList.length?t("i",{slot:"suffix",class:"el-input__icon el-icon-circle-close",on:{click:function(){return e.fileList=[]}}}):null,t("ElButton",u([{attrs:{icon:this.icon}},{on:{click:function(){return e.showModel()}}},{slot:"append"}]))])},makeGroup:function(e){var t=this.$createElement;return(!this.maxLength||this.fileList.length<this.maxLength)&&e.push(this.makeBtn()),t("div",{key:this.key("group")},v(e))},makeItem:function(e,t){return(0,this.$createElement)("div",{class:"fc-files",key:this.key("file"+e)},v(t))},valid:function(e){var t=this.formCreateInject.field||this.field;if(t&&e!==t)throw new Error("[frame]无效的字段值")},makeIcons:function(e,t){var n=this.$createElement;if(!1!==this.handleIcon||!0===this.allowRemove){var i=[];return("file"!==this.type&&!1!==this.handleIcon||"file"===this.type&&this.handleIcon)&&i.push(this.makeHandleIcon(e,t)),this.allowRemove&&i.push(this.makeRemoveIcon(e,t)),n("div",{class:"fc-upload-cover",key:this.key("uc")},[i])}},makeHandleIcon:function(e,t){var n=this;return(0,this.$createElement)("i",{class:!0===this.handleIcon||void 0===this.handleIcon?"el-icon-view":this.handleIcon,on:{click:function(){return n.handleClick(e)}},key:this.key("hi"+t)})},makeRemoveIcon:function(e,t){var n=this;return(0,this.$createElement)("i",{class:"el-icon-delete",on:{click:function(){return n.handleRemove(e)}},key:this.key("ri"+t)})},makeFiles:function(){var e=this,t=this.$createElement;return this.makeGroup(this.fileList.map(function(n,i){return e.makeItem(i,[t("i",{class:"el-icon-tickets",on:{click:function(){return e.handleClick(n)}}}),e.makeIcons(n,i)])}))},makeImages:function(){var e=this,t=this.$createElement;return this.makeGroup(this.fileList.map(function(n,i){return e.makeItem(i,[t("img",{attrs:{src:e.getSrc(n)}}),e.makeIcons(n,i)])}))},makeBtn:function(){var e=this,t=this.$createElement;return t("div",{class:"fc-upload-btn",on:{click:function(){return e.showModel()}},key:this.key("btn")},[t("i",{class:this.icon})])},handleClick:function(e){return this.onHandle(e)},handleRemove:function(e){this.disabled||!1!==this.onBeforeRemove(e)&&(this.fileList.splice(this.fileList.indexOf(e),1),this.onRemove(e))},getSrc:function(e){return this.srcKey?e[this.srcKey]:e},frameLoad:function(e){var t=this;this.onLoad(e);try{!0===this.helper&&(e.form_create_helper={api:this.formCreateInject.api,close:function(e){t.valid(e),t.closeModel()},set:function(e,n){t.valid(e),t.disabled||t.$emit("input",n)},get:function(e){return t.valid(e),t.value},onOk:function(e){return t.$on("$ok",e)},onClose:function(e){return t.$on("$close",e)}})}catch(e){console.log(e)}},makeFooter:function(){var e=this,t=this.$createElement,n=this.$props,i=n.okBtnText,r=n.closeBtnText,o=n.closeBtn,a=n.okBtn;if(n.footer)return t("div",{slot:"footer"},[o?t("ElButton",{on:{click:function(){return!1!==e.onCancel()&&(e.frameVisible=!1)}}},[r]):null,a?t("ElButton",{attrs:{type:"primary"},on:{click:function(){return!1!==e.onOk()&&e.closeModel()}}},[i]):null])}},render:function(){var e,t=this,n=arguments[0],i=this.type;e="input"===i?this.makeInput():"image"===i?this.makeImages():this.makeFiles();var r=this.$props,o=r.width,a=void 0===o?"30%":o,c=r.height,s=r.src,l=r.title,d=r.modalTitle;return this.$nextTick(function(){t.$refs.frame&&t.frameLoad(t.$refs.frame.contentWindow||{})}),n("div",{class:"_fc-frame"},[e,n("el-dialog",u([{},{props:{appendToBody:!0,modal:this.previewMask,title:d,visible:this.previewVisible}},{on:{close:this.handleCancel}}]),[n("img",{style:"width: 100%",attrs:{src:this.previewImage}})]),n("el-dialog",u([{},{props:f(f({width:a,title:l,appendToBody:!0},this.modal),{},{visible:this.frameVisible})},{on:{close:function(){return t.closeModel(!0)}}}]),[this.frameVisible||!this.reload?n("iframe",{ref:"frame",attrs:{src:s,frameBorder:"0"},style:{height:c,border:"0 none",width:"100%"}}):null,this.makeFooter()])])},mounted:function(){this.$on("fc.closeModal",this.closeModal)}},C={name:"fcRadio",props:{formCreateInject:{type:Object,required:!0},value:{},type:String},watch:{"formCreateInject.options":{handler:function(){this.update()},deep:!0},value:function(){this.update()}},data:function(){return{trueValue:[]}},methods:{options:function(){var e=this.formCreateInject.options;return Array.isArray(e)?e:[]},onInput:function(e){this.$emit("input",this.options().filter(function(t){return t.label===e}).reduce(function(e,t){return t.value},""))},update:function(){var e=this;this.trueValue=this.options().filter(function(t){return t.value===e.value}).reduce(function(e,t){return t.label},"")}},created:function(){this.update()},render:function(){var e=this,t=arguments[0];return t("ElRadioGroup",u([{},this.formCreateInject.prop,{},{props:{value:this.trueValue}},{on:{input:this.onInput}}]),[this.options().map(function(n,i){var r=f({},n),o="button"===e.type?"ElRadioButton":"ElRadio";return delete r.value,t(o,u([{},{props:r},{key:o+i+"-"+n.value}]))}),g(this.$slots)])}},O={type:function(e,t){return Object.prototype.toString.call(e)==="[object "+t+"]"},Undef:function(e){return null==e},Element:function(e){return"object"===c(e)&&null!==e&&1===e.nodeType&&!O.Object(e)},trueArray:function(e){return Array.isArray(e)&&e.length>0},Function:function(e){var t=this.getType(e);return"Function"===t||"AsyncFunction"===t},getType:function(e){var t=Object.prototype.toString.call(e);return/^\[object (.*)\]$/.exec(t)[1]},empty:function(e){return null==e||(!(!Array.isArray(e)||!Array.isArray(e)||e.length)||"string"==typeof e&&!e)}};function _(e,t){return{}.hasOwnProperty.call(e,t)}["Date","Object","String","Boolean","Array","Number"].forEach(function(e){O[e]=function(t){return O.type(t,e)}});var w={name:"fcSelect",functional:!0,props:{formCreateInject:{type:Object,required:!0}},render:function(e,t){var n=t.props.formCreateInject.options;return e("ElSelect",u([{},t.data]),[(Array.isArray(n)?n:[]).map(function(t,n){var i=t.slot;return e("ElOption",u([{},{props:t},{key:n+"-"+t.value}]),[i?e("template",{slot:t.slotName||"default"},[O.Function(i)?t.slot(e):i]):null])}),t.children])}},j={name:"fcTree",formCreateParser:{mergeProp:function(e){var t=e.prop.props;t.nodeKey||(t.nodeKey="id"),t.props||(t.props={label:"title"})}},props:{formCreateInject:{type:Object,required:!0},type:{type:String,default:"checked"},value:{type:[Array,String,Number],default:function(){return[]}}},watch:{value:function(){this.setValue()}},methods:{onChange:function(){this.updateValue()},updateValue:function(){var e;this.$refs.tree&&(e="selected"===this.type.toLocaleLowerCase()?this.$refs.tree.getCurrentKey():this.$refs.tree.getCheckedKeys(),this.$emit("input",e))},setValue:function(){"selected"===this.type.toLocaleLowerCase()?this.$refs.tree.setCurrentKey(this.value):this.$refs.tree.setCheckedKeys($(this.value))}},render:function(){var e=this;return(0,arguments[0])("ElTree",u([{},this.formCreateInject.prop,{ref:"tree",on:{check:function(){return e.updateValue()},"node-click":function(){return e.updateValue()}}}]),[g(this.$slots)])},mounted:function(){this.setValue()}};function S(e,t){return{url:e,name:E(e),uid:t}}function E(e){return(""+e).split("/").pop()}k("._fc-upload .fc-files img {\n    width: 100%;\n    height: 100%;\n    display: inline-block;\n    vertical-align: top;\n}\n\n._fc-upload .fc-upload-btn {\n    border: 1px dashed #c0ccda;\n    cursor: pointer;\n}\n\n._fc-upload .fc-upload-cover {\n    opacity: 0;\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    background: rgba(0, 0, 0, .6);\n    -webkit-transition: opacity .3s;\n    -o-transition: opacity .3s;\n    transition: opacity .3s;\n}\n\n._fc-upload .fc-upload-cover i {\n    color: #fff;\n    font-size: 20px;\n    cursor: pointer;\n    margin: 0 2px;\n}\n\n._fc-upload .fc-files:hover .fc-upload-cover {\n    opacity: 1;\n}\n\n._fc-upload .el-upload {\n    display: block;\n}\n\n._fc-upload .fc-upload-btn, ._fc-upload .fc-files {\n    display: inline-block;\n    width: 58px;\n    height: 58px;\n    text-align: center;\n    line-height: 58px;\n    border: 1px solid #c0ccda;\n    border-radius: 4px;\n    overflow: hidden;\n    background: #fff;\n    position: relative;\n    -webkit-box-shadow: 2px 2px 5px rgba(0, 0, 0, .1);\n    box-shadow: 2px 2px 5px rgba(0, 0, 0, .1);\n    margin-right: 4px;\n    -webkit-box-sizing: border-box;\n    box-sizing: border-box;\n}\n");var R={name:"fcUpload",props:{formCreateInject:{type:Object,required:!0},onHandle:{type:Function,default:function(e){this.previewImage=e.url,this.previewVisible=!0}},uploadType:{type:String,default:"file"},limit:{type:Number,default:0},allowRemove:{type:Boolean,default:!0},previewMask:void 0,modalTitle:String,handleIcon:{type:[String,Boolean],default:function(){}},value:[Array,String]},data:function(){return{uploadList:[],previewVisible:!1,previewImage:"",cacheFiles:[]}},created:function(){void 0===this.formCreateInject.prop.props.showFileList&&(this.formCreateInject.prop.props.showFileList=!1),this.formCreateInject.prop.props.fileList=$(this.value).map(S)},watch:{value:function(e){this.$refs.upload.uploadFiles.every(function(e){return!e.status||"success"===e.status})&&(this.$refs.upload.uploadFiles=$(e).map(S),this.uploadList=this.$refs.upload.uploadFiles)},limit:function(e,t){1!==t&&1!==e||this.update()}},methods:{key:function(e){return e},isDisabled:function(){return!0===this.formCreateInject.prop.props.disabled},onRemove:function(e){this.isDisabled()||this.$refs.upload.handleRemove(e)},handleClick:function(e){this.onHandle(e)},makeItem:function(e,t){var n=this.$createElement;return"image"===this.uploadType?n("img",{attrs:{src:e.url},key:this.key("img"+t)}):n("i",{class:"el-icon-tickets",key:this.key("i"+t)})},makeRemoveIcon:function(e,t){var n=this;return(0,this.$createElement)("i",{class:"el-icon-delete",on:{click:function(){return n.onRemove(e)}},key:this.key("ri"+t)})},makeHandleIcon:function(e,t){var n=this;return(0,this.$createElement)("i",{class:!0===this.handleIcon||void 0===this.handleIcon?"el-icon-view":this.handleIcon,on:{click:function(){return n.handleClick(e)}},key:this.key("hi"+t)})},makeProgress:function(e,t){return(0,this.$createElement)("ElProgress",u([{},{props:{percentage:e.percentage,type:"circle",width:52}},{style:"margin-top:2px;",key:this.key("pg"+t)}]))},makeIcons:function(e,t){var n=this.$createElement,i=[];if(this.allowRemove||!1!==this.handleIcon)return("file"!==this.uploadType&&!1!==this.handleIcon||"file"===this.uploadType&&this.handleIcon)&&i.push(this.makeHandleIcon(e,t)),this.allowRemove&&i.push(this.makeRemoveIcon(e,t)),n("div",{class:"fc-upload-cover"},[i])},makeFiles:function(){var e=this,t=this.$createElement;return this.uploadList.map(function(n,i){return e.$scopedSlots.fileList?e.$scopedSlots.fileList({file:n,index:i,vm:e}):t("div",{key:e.key(i),class:"fc-files"},[void 0!==n.percentage&&"success"!==n.status?e.makeProgress(n,i):[e.makeItem(n,i),e.makeIcons(n,i)]])})},makeUpload:function(){var e=this.$createElement,t=!this.limit||this.limit>this.uploadList.length;return e("ElUpload",u([{},this.formCreateInject.prop,{ref:"upload",style:{display:"inline-block"},key:this.key("upload")}]),[t?e("template",{slot:"default"},[this.$slots.default||e("div",{class:"fc-upload-btn"},[e("i",{class:"el-icon-upload2"})])]):null,g(this.$slots,["default"])])},update:function(){var e=this.$refs.upload.uploadFiles.map(function(e){return e.url}).filter(function(e){return void 0!==e});this.cacheFiles.length===e.length&&e.length||(this.cacheFiles=v(e),this.$emit("input",1===this.limit?e[0]||"":e))},handleCancel:function(){this.previewVisible=!1}},render:function(){var e=arguments[0];return this.$refs.upload&&(void 0===this.formCreateInject.prop.props.showFileList&&(this.formCreateInject.prop.props.showFileList=this.$refs.upload.showFileList),this.formCreateInject.prop.props.fileList=this.$refs.upload.fileList),e("div",{class:"_fc-upload"},[[this.formCreateInject.prop.props.showFileList?[]:this.makeFiles(),this.makeUpload()],e("el-dialog",u([{},{props:{appendToBody:!0,modal:this.previewMask,title:this.modalTitle,visible:this.previewVisible}},{on:{close:this.handleCancel}}]),[e("img",{attrs:{alt:"example",src:this.previewImage},style:"width: 100%"})])])},mounted:function(){var e=this;this.uploadList=this.$refs.upload.uploadFiles,this.$watch(function(){return e.$refs.upload.uploadFiles},function(){e.update()},{deep:!0})}};function F(e,n,i){t.set(e,n,i)}function I(e,n){t.delete(e,n)}function V(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,i=!1;for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var o=t[r];if((i=Array.isArray(o))||O.Object(o)){var a=void 0===e[r];if(i)i=!1,a&&F(e,r,[]);else if(o._clone&&void 0!==n){if(!n){F(e,r,o._clone());continue}o=o.getRule(),a&&F(e,r,{})}else a&&F(e,r,{});e[r]=V(e[r],o,n)}else F(e,r,o),O.Undef(o)||(O.Undef(o.__json)||(e[r].__json=o.__json),O.Undef(o.__origin)||(e[r].__origin=o.__origin))}return void 0!==n&&Array.isArray(e)?e.filter(function(e){return!e||!e.__ctrl}):e}function A(e){return V({},{value:e}).value}var P=Object.assign||function(e){for(var t,n=1;n<arguments.length;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&F(e,i,t[i]);return e};function T(){return P.apply(this,arguments)}var B=[b,x,C,w,j,R,{name:"fcGroup",props:{field:String,rule:[Array,Object],rules:Array,expand:Number,options:Object,formCreateInject:{type:Object,required:!0},button:{type:Boolean,default:!0},max:{type:Number,default:0},min:{type:Number,default:0},value:{type:Array,default:function(){return[]}},defaultValue:Object,disabled:{type:Boolean,default:!1},syncDisabled:{type:Boolean,default:!0},fontSize:{type:Number,default:28},onBeforeRemove:{type:Function,default:function(){}},onBeforeAdd:{type:Function,default:function(){}}},data:function(){return{len:0,cacheRule:{},cacheValue:{},type:void 0}},computed:{formRule:function(){return this.rules?this.rules:this.rule?Array.isArray(this.rule)?this.rule:[this.rule]:[]}},watch:{formRule:{handler:function(e,t){var n=this;Object.keys(this.cacheRule).forEach(function(i){var r=n.cacheRule[i];if(r.$f){var o=r.$f.formData();if(e===t)r.$f.deferSyncValue(function(){V(r.rule,e),r.$f.setValue(o)},!0);else{var a=r.$f.formData();r.$f.once("reloading",function(){r.$f.setValue(a)}),r.rule=A(e)}}})},deep:!0},disabled:function(e){if(this.syncDisabled){var t=this.cacheRule;Object.keys(t).forEach(function(n){t[n].$f.disabled(e)})}},expand:function(e){var t=e-this.value.length;t>0&&this.expandRule(t)},value:function(e){var t=this;e=e||[];var n=Object.keys(this.cacheRule),i=n.length,r=i-e.length;if(r<0){for(var o=r;o<0;o++)this.addRule(e.length+o);for(var a=0;a<i;a++)this.setValue(n[a],e[a])}else{if(r>0)for(var u=0;u<r;u++)this.removeRule(n[i-u-1]);e.forEach(function(i,r){t.setValue(n[r],e[r])})}}},methods:{_value:function(e){return e&&_(e,this.field)?e[this.field]:e},cache:function(e,t){this.cacheValue[e]=JSON.stringify(t)},input:function(e){this.$emit("input",e),this.$emit("change",e)},formData:function(e,t){var n=this,i=this.cacheRule,r=Object.keys(i);if(r.filter(function(e){return i[e].$f}).length===r.length){var o=r.map(function(i){var r=e===i?t:f({},n.cacheRule[i].$f.form),o=n.field?r[n.field]||null:r;return n.cache(i,o),o});this.input(o)}},setValue:function(e,t){var n=this.field,i=this.cacheRule[e].$f;n&&(t=s({},n,this._value(t))),this.cacheValue[e]!==JSON.stringify(n?t[n]:t)&&(this.cache(e,t),i.coverValue(t||{}))},addRule:function(e,t){var n=this,i=this.formCreateInject.form.copyRules(this.formRule),r=this.options?f({},this.options):{submitBtn:!1,resetBtn:!1};if(this.defaultValue){r.formData||(r.formData={});var o=A(this.defaultValue);T(r.formData,this.field?s({},this.field,o):o)}this.$set(this.cacheRule,++this.len,{rule:i,options:r}),t&&this.$nextTick(function(){return n.$emit("add",i,Object.keys(n.cacheRule).length-1)})},add$f:function(e,t,n){var i=this;this.cacheRule[t].$f=n,this.formData(t,n.formData()),this.$nextTick(function(){i.syncDisabled&&n.disabled(i.disabled),i.$emit("itemMounted",n,Object.keys(i.cacheRule).indexOf(t))})},removeRule:function(e,t){var n=this,i=Object.keys(this.cacheRule).indexOf(e);this.$delete(this.cacheRule,e),this.$delete(this.cacheValue,e),t&&this.$nextTick(function(){return n.$emit("remove",i)})},add:function(e){this.disabled||!1===this.onBeforeAdd(this.value)||this.addRule(e,!0)},del:function(e,t){this.disabled||!1===this.onBeforeRemove(this.value,e)||(this.removeRule(t,!0),this.value.splice(e,1),this.input(this.value))},addIcon:function(e){return(0,this.$createElement)("i",{key:"a".concat(e),class:"el-icon-circle-plus-outline",style:"font-size:".concat(this.fontSize,"px;cursor:").concat(this.disabled?"not-allowed;color:#c9cdd4":"pointer",";"),on:{click:this.add}})},delIcon:function(e,t){var n=this;return(0,this.$createElement)("i",{key:"d".concat(t),class:"el-icon-remove-outline",style:"font-size:".concat(this.fontSize,"px;cursor:").concat(this.disabled?"not-allowed;color:#c9cdd4":"pointer;color:#606266",";"),on:{click:function(){return n.del(e,t)}}})},makeIcon:function(e,t,n){var i=this;return this.$scopedSlots.button?this.$scopedSlots.button({total:e,index:t,vm:this,key:n,del:function(){return i.del(t,n)},add:this.add}):0===t?[0!==this.max&&e>=this.max?null:this.addIcon(n),0===this.min||e>this.min?this.delIcon(t,n):null]:e>this.min?this.delIcon(t,n):void 0},emitEvent:function(e,t,n,i){this.$emit.apply(this,[e].concat(v(t),[this.cacheRule[i].$f,n]))},expandRule:function(e){for(var t=0;t<e;t++)this.value.push(this.field?null:{})}},created:function(){this.type=this.formCreateInject.form.$form();var e=(this.expand||0)-this.value.length;e>0&&this.expandRule(e);for(var t=0;t<this.value.length;t++)this.addRule(t)},render:function(){var e=this,t=arguments[0],n=Object.keys(this.cacheRule),i=this.button,r=this.type;return 0===n.length?this.$scopedSlots.default?this.$scopedSlots.default({vm:this,add:this.add}):t("i",{key:"a_def",class:"el-icon-circle-plus-outline",style:"font-size:".concat(this.fontSize,"px;vertical-align:middle;color:").concat(this.disabled?"#c9cdd4;cursor: not-allowed":"#606266;cursor:pointer",";"),on:{click:this.add}}):t("div",{key:"con"},[n.map(function(o,a){var c=e.cacheRule[o],l=c.rule,f=c.options;return t("ElRow",{attrs:{align:"middle",type:"flex"},key:o,style:"border-bottom:1px dashed #DCDFE6;margin-bottom:10px;"},[t("ElCol",{attrs:{span:i?20:24}},[t(r,u([{key:o},{on:{"update:value":function(t){return e.formData(o,t)},"emit-event":function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return e.emitEvent(t,i,a,o)},input:function(t){return e.add$f(a,o,t)}}},{},{props:{value:e.field?s({},e.field,e._value(e.value[a])):e.value[a],rule:l,option:f,extendOption:!0,inFor:!0}}]))]),i?t("ElCol",u([{},{props:{span:2,pull:1,push:1}}]),[e.makeIcon(n.length,a,o)]):null])})])}},{name:"fcSubForm",props:{rule:Array,options:Object,formCreateInject:{type:Object,required:!0},value:{type:Object,default:function(){return{}}},disabled:{type:Boolean,default:!1},syncDisabled:{type:Boolean,default:!0}},data:function(){return{cacheRule:{},cacheValue:{},type:void 0}},watch:{disabled:function(e){this.syncDisabled&&this.cacheRule.$f.disabled(e)},value:function(e){this.setValue(e)}},methods:{formData:function(e){this.cacheValue=JSON.stringify(e),this.$emit("input",e),this.$emit("change",e)},setValue:function(e){var t=JSON.stringify(e);this.cacheValue!==t&&(this.cacheValue=t,this.cacheRule.$f.coverValue(e||{}))},addRule:function(){var e=this.options?this.options:{submitBtn:!1,resetBtn:!1};e.formData=f({},this.value||{}),this.cacheRule={rule:this.rule,options:e}},add$f:function(e){var t=this;this.cacheRule.$f=e,this.$nextTick(function(){t.syncDisabled&&e.disabled(t.disabled),t.$emit("itemMounted",e)})},emitEvent:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.$emit.apply(this,[e].concat(n))}},created:function(){this.addRule(),this.type=this.formCreateInject.form.$form()},render:function(){var e=arguments[0],t=this.cacheRule,n=t.rule,i=t.options;return e(this.type,u([{},{on:{"update:value":this.formData,"emit-event":this.emitEvent,input:this.add$f}},{},{props:{rule:n,option:i,extendOption:!0}}]))}}],D="FormCreate",L=function e(t,n){if(t&&t!==n)return t.formCreateInject?t.formCreateInject:t.$parent?e(t.$parent,n):void 0};function N(e){return{name:D,componentName:D,model:{prop:"api"},provide:function(){return{$pfc:this}},inject:{$pfc:{default:null}},props:{rule:{type:Array,required:!0},option:{type:Object,default:function(){return{}}},extendOption:Boolean,value:Object,api:Object,name:String,subForm:{type:Boolean,default:!0},inFor:Boolean},data:function(){return{formData:void 0,destroyed:!1,validate:{},$f:void 0,isShow:!0,unique:1,renderRule:v(this.rule||[]),ctxInject:{},updateValue:JSON.stringify(this.value||{}),isMore:!!this.inFor}},render:function(){return this.formCreate.render()},methods:{_refresh:function(){++this.unique},_renderRule:function(){this.renderRule=v(this.rule||[])},_updateValue:function(e){this.destroyed||(this.updateValue=JSON.stringify(e),this.$emit("update:value",e))}},watch:{value:{handler:function(e){JSON.stringify(e||{})!==this.updateValue&&(this.$f.config.forceCoverValue?this.$f.coverValue(e||{}):this.$f.setValue(e||{}))},deep:!0},option:{handler:function(e){this.formCreate.initOptions(e),this.$f.refresh()},deep:!0},rule:function(e){var t=this;e.length===this.renderRule.length&&e.every(function(e){return t.renderRule.indexOf(e)>-1})||(this.formCreate.$handle.reloadRule(e),this._renderRule())}},beforeCreate:function(){var t=this,n=this.$options.propsData,i=n.rule,r=n.option;this.formCreate=new e(this,i,r),Object.keys(this.formCreate.prop).forEach(function(e){T(t.$options[e],t.formCreate.prop[e])}),this.$emit("beforeCreate",this.formCreate.api())},created:function(){var e=this,t=this,n=this.formCreate.api(),i=function(){var e=L(t,t.$pfc);if(e)if(t.isMore){var i=$(e.getSubForm()),r=i.indexOf(n);r>-1&&i.splice(r,1)}else e.subForm()};t.$on("hook:beforeDestroy",function(){i()}),this.$watch(function(){return e.subForm},function(e){e?function(){if(t.$pfc){var e,i=L(t,t.$pfc);i&&(t.isMore?(e=$(i.getSubForm())).push(n):e=n,i.subForm(e))}}():i()},{immediate:!0})}}}var M=["attrs","props","domProps","scopedSlots"],q=["class","style","directives"],H=["on","nativeOn"],U=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=[].concat(M,v(i.normal||[])),o=[].concat(q,v(i.array||[])),a=[].concat(H,v(i.functional||[])),u=i.props||[];return t.reduce(function(t,n){for(var i in n)if(t[i])if(u.indexOf(i)>-1)t[i]=e([n[i]],t[i]);else if(r.indexOf(i)>-1)t[i]=f(f({},t[i]),n[i]);else if(o.indexOf(i)>-1){var s=t[i]instanceof Array?t[i]:[t[i]],l=n[i]instanceof Array?n[i]:[n[i]];t[i]=[].concat(v(s),v(l))}else if(a.indexOf(i)>-1)for(var d in n[i])if(t[i][d]){var p=t[i][d]instanceof Array?t[i][d]:[t[i][d]],h=n[i][d]instanceof Array?n[i][d]:[n[i][d]];t[i][d]=[].concat(v(p),v(h))}else t[i][d]=n[i][d];else if("hook"===i)for(var m in n[i])t[i][m]?t[i][m]=z(t[i][m],n[i][m]):t[i][m]=n[i][m];else t[i]=n[i];else r.indexOf(i)>-1||a.indexOf(i)>-1||u.indexOf(i)>-1?t[i]=f({},n[i]):o.indexOf(i)>-1?t[i]=n[i]instanceof Array?v(n[i]):"object"===c(n[i])?f({},n[i]):n[i]:t[i]=n[i];return t},n)},z=function(e,t){return function(){e&&e.apply(this,arguments),t&&t.apply(this,arguments)}},J=["type","slot","emitPrefix","value","name","native","hidden","display","inject","options","emit","nativeEmit","link","prefix","suffix","update","sync","optionsTo","key","preview","component","cache"],W=["validate","children","control"],K=["effect","deep"];function G(e,t,n){return"[form-create ".concat(e,"]: ").concat(t)+(n?"\n\nrule: "+JSON.stringify(n.getRule?n.getRule():n):"")}function X(e,t){console.error(G("err",e,t))}var Q="[[FORM-CREATE-PREFIX-",Z="-FORM-CREATE-SUFFIX]]",Y="$FN:",ee="$FNX:",te="function";function ne(e,t){return JSON.stringify(V([],e,!0),function(e,t){if(!t||!0!==t._isVue){if(c(t)!==te)return t;if(t.__json)return t.__json;if(t.__origin&&(t=t.__origin),!t.__emit)return Q+t+Z}},t)}function ie(e){return new Function("return "+e)()}function re(e,t){if(e&&O.String(e)&&e.length>4){var n=e.trim(),i=!1;try{if(n.indexOf(Z)>0&&0===n.indexOf(Q))n=n.replace(Z,"").replace(Q,""),i=!0;else if(0===n.indexOf(Y))n=n.replace(Y,""),i=!0;else{if(0===n.indexOf(ee))return(n=ie("function($inject){"+n.replace(ee,"")+"}")).__json=e,n.__inject=!0,n;t||0!==n.indexOf(te)||n===te||(i=!0)}if(!i)return e;var r=ie(-1===n.indexOf(te)&&0!==n.indexOf("(")?te+" "+n:n);return r.__json=e,r}catch(e){return void X("解析失败:".concat(n,"\n\nerr: ").concat(e))}}return e}function oe(e,t){return JSON.parse(e,function(e,n){return O.Undef(n)||!n.indexOf?n:re(n,t)})}function ae(e,t){return{value:e,enumerable:!1,configurable:!1,writable:!!t}}function ue(e){return ce([e])[0]}function ce(e,t){return V([],v(e),t||!1)}function se(e,t){return U(Array.isArray(t)?t:[t],e,{array:W,normal:K}),e}function le(e){var t=O.Function(e.getRule)?e.getRule():e;return t.type||(t.type="input"),t}function fe(e,t){Object.defineProperties(e,Object.keys(t).reduce(function(e,n){return e[n]={get:function(){return t[n]()}},e},{}))}function de(e){return e.__fc__||(e.__origin__?e.__origin__.__fc__:null)}function pe(e,t){try{t=e()}catch(e){!function(e){X(e.toString()),console.error(e)}(e)}return t}function he(e,t){return function(n,i,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=new me(e,n,i,r,o);return t&&(O.Function(t)?t(a):a.props(t)),a}}function me(e,t,n,i,r){this._data=T({props:{},on:{},options:[],children:[],effect:{},hidden:!1,display:!0,value:void 0},{type:e,title:t,field:n,value:i,props:r||{}}),this.event=this.on}function ve(e){e.forEach(function(e){me.prototype[e]=function(t){return se(this._data,s({},e,arguments.length<2?t:s({},t,arguments[1]))),this}})}T(me.prototype,{getRule:function(){return this._data},setProp:function(e,t){return F(this._data,e,t),this},_clone:function(){var e=new this.constructor;return e._data=ue(this._data),e}}),ve([].concat(J,v(M),v(q),v(H),W,K));var ye=he("");function ge(e,t,n){var i=ye("",t);return i._data.type=e,i._data.title=n,i}function be(e,t,n,i){var r=ye("",n);return r._data.type="template",r._data.template=e,r._data.title=i,r._data.vm=t,r}function $e(){return{create:ge,createTmp:be,template:be,factory:he}}function ke(e){return A(e)}function xe(e){return Ce(e.replace(/(-[a-z])/g,function(e){return e.replace("-","").toLocaleUpperCase()}))}function Ce(e){return e.replace(e[0],e[0].toLowerCase())}function Oe(e){return null==e?"":"object"===c(e)?JSON.stringify(e,null,2):String(e)}function _e(e){var t=e.replace(/([A-Z])/g,"-$1").toLocaleLowerCase();return 0===t.indexOf("-")&&(t=t.substr(1)),t}var we=0;function je(){return"F"+Math.random().toString(36).substr(3,3)+Number("".concat(Date.now()).concat(++we)).toString(36)}function Se(e,t,n){var i,r=e;return(t||"").split(".").forEach(function(e){i&&(r[i]&&"object"==c(r[i])||(r[i]={}),r=r[i]),i=e}),r[i]=n,r}function Ee(e){T(this,{$handle:e,fc:e.fc,vm:e.vm,$manager:e.$manager,vNode:new e.fc.CreateNode(e.vm)}),fe(this,{options:function(){return e.options},sort:function(){return e.sort}}),this.initCache(),this.initRender()}!function(e){T(e.prototype,{initCache:function(){this.clearCacheAll()},clearCache:function(e){if(!e.rule.cache)if(this.cache[e.id]){(!0===this.cache[e.id].use||this.cache[e.id].parent)&&this.$handle.refresh();var t=this.cache[e.id].parent;this.cache[e.id]=null,t&&this.clearCache(t)}else e.parent&&this.clearCache(e.parent)},clearCacheAll:function(){this.cache={}},setCache:function(e,t,n){this.cache[e.id]={vnode:t,use:!1,parent:n,slot:e.rule.slot}},getCache:function(e){var t=this.cache[e.id];if(t)return t.use=!0,t.vnode}})}(Ee),function(e){T(e.prototype,{initRender:function(){this.tempList={},this.clearOrgChildren()},initOrgChildren:function(){var e=this.$handle.ctxs;this.orgChildren=Object.keys(e).reduce(function(t,n){if(!1!==e[n].parser.loadChildren){var i=e[n].rule.children;t[n]=O.trueArray(i)?v(i):[]}return t},{})},clearOrgChildren:function(){this.orgChildren={}},getTypeSlot:function(e){return function t(n){if(n){var i=void 0;return e.rule.field&&(i=n.$scopedSlots["field-"+_e(e.rule.field)]||n.$scopedSlots["field-"+e.rule.field]),i||(i=n.$scopedSlots["type-"+_e(e.type)]||n.$scopedSlots["type-"+e.type]),i||t(n.$pfc)}}(this.vm)},render:function(){var e=this;if(this.vm.isShow){var t;this.$h=this.vm.$createElement,this.$manager.beforeRender();var n=function(){return e.renderList()};return n.renderSlot=function(t){return e.renderList(t)},n.renderName=function(t){return e.renderId(t)},n.renderField=function(t){return e.renderId(t,"field")},t=this.vm.$scopedSlots.container?[this.vm.$scopedSlots.container(n)]:n(),this.$manager.render(t)}},renderList:function(e){var t=this;return this.sort.map(function(n){return e?t.renderSlot(t.$handle.ctxs[n],e):t.renderCtx(t.$handle.ctxs[n])}).filter(function(e){return void 0!==e})},makeVm:function(e){var t=this,n=e.vm;return n?O.Function(n)?pe(function(){return e.vm(t.$handle.getInjectData(e))}):n._isVue?n:new Xe(n):new Xe},mergeGlobal:function(e){var t=this.$handle.options.global;t&&(e.cacheConfig||(e.cacheConfig=t[e.originType]||t[e.type]||t[e.trueType]||{}),e.prop=se({},[t["*"],e.cacheConfig,e.prop]))},setOptions:function(e){e.prop.optionsTo&&e.prop.options&&Se(e.prop,e.prop.optionsTo,e.prop.options)},deepSet:function(e){var t=e.rule.deep;t&&Object.keys(t).sort(function(e,t){return e.length<t.length?-1:1}).forEach(function(n){Se(e.prop,n,t[n])})},setTempProps:function(e,t){if(e.$props){var n=t.prop,i=Object.keys(e.$props),r=this.injectProp(t),o=Object.keys(r);i.forEach(function(t){_(n.props,t)?e.$props[t]=n.props[t]:o.indexOf(t)>-1&&(e.$props[t]=r[t])});var a=e.$options.model&&e.$options.model.prop||"value";i.indexOf(a)>-1&&(e.$props[a]=n.value)}},renderTemp:function(e){var t=this;if(!Xe.compile)return function(e,t){console.warn(G("tip",e,t))}("当前使用的Vue构建版本不支持compile,无法使用template功能"),[];var n=e.prop,i=e.id,r=e.key;if(!this.tempList[i]){e.el||(e.el=this.makeVm(n),this.vm.$nextTick(function(){return e.parser.mounted(e)}));var o=e.el;e.input&&o.$on(o.$options.model&&o.$options.model.event||"input",function(n){t.onInput(e,n)}),this.tempList[i]={vm:o,template:Xe.compile(n.template)}}var a=this.tempList[i],u=a.vm,c=a.template;this.setTempProps(u,e);var s=c.render.call(u);return O.Undef(s.data)&&(s.data={}),s.key=r,s.data.ref=e.ref,s.data.key=r,s},parseSide:function(e,t){return O.Object(e)?se({props:{formCreateInject:t.prop.props.formCreateInject}},e):e},renderSides:function(e,t,n){var i=t[n?"rule":"prop"];return[this.renderRule(this.parseSide(i.prefix,t)),e,this.renderRule(this.parseSide(i.suffix,t))]},renderSlot:function(e,t){return e.rule.slot===t?this.renderCtx(e):void 0},renderId:function(e,t){var n=this,i=this.$handle["field"===t?"fieldCtx":"nameCtx"][e];return i?i.map(function(e){return n.renderCtx(e,e.parent)}):void 0},renderCtx:function(e,t){if("hidden"!==e.type){var n=e.rule;if(!this.cache[e.id]||this.cache[e.id].slot!==n.slot){var i,r=!1!==n.cache,o=e.trueType,a=!(O.Undef(n.display)||n.display);if("template"!==o||n.template)if("fcFragment"===o)i=this.renderChildren(e);else{e.initProp(),this.mergeGlobal(e),this.$manager.tidyRule(e),this.deepSet(e),this.setOptions(e),this.ctxProp(e);var u=e.prop;u.preview=!!(_(u,"preview")?u.preview:this.options.preview),u.props.formCreateInject=this.injectProp(e);var c=u.preview;if(u.hidden)return void this.setCache(e,void 0,t);if("template"===o&&u.template)i=this.renderTemp(e),r=!1;else{var s=[];e.parser.renderChildren?s=e.parser.renderChildren(e):!1!==e.parser.loadChildren&&(s=this.renderChildren(e));var l=this.getTypeSlot(e);i=l?l({rule:n,prop:u,preview:c,children:s,api:this.$handle.api,model:u.model||{}}):c?e.parser.preview(s,e):e.parser.render(s,e)}i=this.renderSides(i,e),!e.input&&O.Undef(u.native)||!0===u.native||(i=this.$manager.makeWrap(e,i)),a&&(i=this.display(i)),i=this.item(e,i)}else i=this.renderSides(this.renderChildren(e),e,!0),a&&this.display(i),i=this.item(e,i);return r&&this.setCache(e,i,t),i}return this.getCache(e)}},display:function(e){var t=this;if(Array.isArray(e)){var n=[];return e.forEach(function(e){if(Array.isArray(e))return t.display(e);t.none(e)&&n.push(e)}),n}return this.none(e)},none:function(e){if(e&&e.data)return Array.isArray(e.data.style)?e.data.style.push({display:"none"}):O.String(e.data.style)?e.data.style+=";display:none;":e.data.style=[e.data.style,{display:"none"}],e},item:function(e,t){return this.$h("fcFragment",{slot:e.rule.slot,key:e.key},[t])},injectProp:function(e){var t=this;this.vm.ctxInject[e.id]||F(this.vm.ctxInject,e.id,{api:this.$handle.api,form:this.fc.create,subForm:function(n){t.$handle.addSubForm(e,n)},getSubForm:function(){return t.$handle.subForm[e.id]},options:[],children:[],prop:{},preview:!1,field:e.field,rule:e.rule,input:e.input});var n,i=this.vm.ctxInject[e.id];return T(i,{preview:e.prop.preview,options:e.prop.options,children:e.rule.children,prop:(n=f({},e.prop),n.on=n.on?f({},n.on):{},delete n.model,n)}),i},ctxProp:function(e,t){var n=this,i=e.ref,r=e.key,o=e.rule;this.$manager.mergeProp(e,t),e.parser.mergeProp(e,t);var a=[{ref:i,key:o.key||"".concat(r,"fc"),slot:void 0,on:{"hook:mounted":function(){n.onMounted(e)},"fc.sub-form":function(t){n.$handle.addSubForm(e,t)}}}];return!t&&e.input&&(e.prop.model={value:this.$handle.getFormData(e),callback:function(t){n.onInput(e,t)},expression:"formData.".concat(e.id)}),U(a,e.prop),e.prop},onMounted:function(e){e.el=this.vm.$refs[e.ref],e.el&&((e.el.$el||e.el).__rule__=e.rule),e.parser.mounted(e),this.$handle.effect(e,"mounted")},onInput:function(e,t){this.$handle.onInput(e,t)},renderChildren:function(e){var t=this,n=e.rule.children,i=this.orgChildren[e.id],r=function(e){return!O.String(e)&&e.__fc__&&!t.$handle.ctxs[e.__fc__.id]};return!O.trueArray(n)&&i?(this.$handle.deferSyncValue(function(){i.forEach(function(e){e&&r(e)&&t.$handle.rmCtx(e.__fc__)})}),this.orgChildren[e.id]=[],[]):(i&&this.$handle.deferSyncValue(function(){i.forEach(function(e){e&&-1===n.indexOf(e)&&r(e)&&t.$handle.rmCtx(e.__fc__)})}),n.map(function(i){if(i)return O.String(i)?i:i.__fc__?t.renderCtx(i.__fc__,e):void(i.type&&t.vm.$nextTick(function(){t.$handle.loadChildren(n,e),t.$handle.refresh()}))}))},defaultRender:function(e,t){var n=e.prop;return n.component?this.vNode.makeComponent(n.component,n,t):this.vNode[e.type]?this.vNode[e.type](n,t):this.vNode[e.originType]?this.vNode[e.originType](n,t):this.vNode.make(Ce(e.originType),n,t)},renderRule:function(e,t,n){var i=this;if(e){if(O.String(e))return e;var r;if(n)r=e.type;else if(r=e.is,e.type){r=xe(e.type);var o=this.vNode.aliasMap[r];o&&(r=xe(o))}if(r){var a=[[t]];return O.trueArray(e.children)&&a.push(e.children.map(function(e){return i.renderRule(e)})),this.$h(r,f({},e),a)}}}})}(Ee);var Re=["hook:updated","hook:mounted"];function Fe(e,t,n){var i,r=je();T(this,{id:r,ref:r,wrapRef:r+"fi",rule:t,origin:t.__origin__||t,name:t.name,watch:[],linkOn:[],root:[],ctrlRule:[],parent:null,cacheConfig:null,prop:f({},t),computed:{},payload:{},input:!!t.field,el:void 0,defaultValue:t.field?A(n):void 0,field:t.field||void 0}),this.updateType(),this.updateKey(),i=this,Object.defineProperties(i.origin,{__fc__:ae(i,!0)}),this.update(e,!0)}T(Fe.prototype,{effectData:function(e){return this.payload[e]||(this.payload[e]={}),this.payload[e]},clearEffectData:function(e){void 0===e?this.payload={}:delete this.payload[e]},updateKey:function(e){this.key=je(),e&&this.parent&&this.parent.updateKey(e)},updateType:function(){this.originType=this.rule.type,this.type=xe(this.rule.type)},setParser:function(e){this.parser=e,e.init(this)},initProp:function(){var e=this,t=f({},this.rule);delete t.children,this.prop=se({},[t].concat(v(Object.keys(this.payload).map(function(t){return e.payload[t]})),[this.computed]))},check:function(e){return this.vm===e.vm},unwatch:function(){this.watch.forEach(function(e){return e()}),this.watch=[]},unlink:function(){this.linkOn.forEach(function(e){return e()}),this.linkOn=[]},link:function(){this.unlink(),this.$handle.appendLink(this)},watchTo:function(){this.$handle.watchCtx(this)},delete:function(){this.unwatch(),this.unlink(),this.rmCtrl(),T(this,{deleted:!0,prop:f({},this.rule),computed:{},el:void 0,$handle:void 0,$render:void 0,$api:void 0,vm:void 0,vNode:void 0,parent:null,cacheConfig:null})},rmCtrl:function(){this.ctrlRule.forEach(function(e){return e.__fc__&&e.__fc__.rm()}),this.ctrlRule=[]},rm:function(){var e=this,t=function(){var t=e.root.indexOf(e.origin);t>-1&&(e.root.splice(t,1),e.$handle&&e.$handle.refresh())};this.deleted?t():this.$handle.noWatch(function(){e.$handle.deferSyncValue(function(){e.rmCtrl(),t(),e.$handle.rmCtx(e),T(e,{root:[]})},e.input)})},update:function(e,t){T(this,{deleted:!1,$handle:e,$render:e.$render,$api:e.api,vm:e.vm,trueType:e.getType(this.originType),vNode:e.$render.vNode,updated:!1}),!t&&this.unwatch(),this.watchTo(),this.link()}});var Ie={"==":function(e){return function(t){return t===e}},"!=":function(e){return function(t){return t!==e}},"<>":function(e){return function(t){return t!==e}},">":function(e){return function(t){return t>e}},">=":function(e){return function(t){return t>=e}},"<":function(e){return function(t){return t<e}},"<=":function(e){return function(t){return t<=e}},in:function(e){return function(t){return e&&e.indexOf&&e.indexOf(t)>-1}},on:function(e){return function(t){return t&&t.indexOf&&t.indexOf(e)>-1}},notIn:function(e){return function(t){return!Ie.in(e)(t)}},notOn:function(e){return function(t){return!Ie.on(e)(t)}},between:function(e){return function(t){return t>e[0]&&t<e[1]}},notBetween:function(e){return function(t){return t<e[0]||t>e[1]}}};function Ve(e,t){for(var n=0;n<e.ctrlRule.length;n++){var i=e.ctrlRule[n];if(i.children===t)return i}}function Ae(e){return!!e.rule.__ctrl}function Pe(e,t){return"function"==typeof t?""+t:t}function Te(e){Object.keys(e).forEach(function(t){return delete e[t]})}var Be={init:function(e){},toFormValue:function(e,t){return e},toValue:function(e,t){return e},mounted:function(e){},render:function(e,t){return t.$render.defaultRender(t,e)},preview:function(e,t){return this.render(e,t)},mergeProp:function(e){}},De=["field","value","vm","template","name","config","control","inject","sync","payload","optionsTo","update","component","cache"];function Le(e){var t=this;T(this,{fc:e,vm:e.vm,watching:!1,loading:!1,reloading:!1,noWatchFn:null,deferSyncFn:null,isMounted:!1,formData:{},subForm:{},form:{},appendData:{},providers:{},cycleLoad:null,loadedId:1,nextTick:null,changeStatus:!1,pageEnd:!0,nextReload:function(){t.lifecycle("reload")}}),fe(this,{options:function(){return e.options},bus:function(){return e.bus}}),this.initData(e.rules),this.$manager=new e.manager(this),this.$render=new Ee(this),this.api=e.extendApi(function(e){function t(t){return O.Undef(t)?t=e.fields():Array.isArray(t)||(t=[t]),t}function n(n,i,r){t(n).forEach(function(t){e.getCtxs(t).forEach(function(t){F(t.rule,i,r),e.$render.clearCache(t)})})}function i(){var t=e.subForm;return Object.keys(t).reduce(function(e,n){var i=t[n];return i?(Array.isArray(i)?e.push.apply(e,v(i)):e.push(i),e):e},[])}var r={get config(){return e.options},get options(){return e.options},get form(){return e.form},get rule(){return e.rules},get parent(){return e.vm.$pfc&&e.vm.$pfc.$f},get children(){return i()},formData:function(n){return t(n).reduce(function(t,n){var i=e.getFieldCtx(n);return i?(t[i.field]=ke(i.rule.value),t):t},e.options.appendValue?ke(e.appendData):{})},getValue:function(t){var n=e.getFieldCtx(t);if(n)return ke(n.rule.value)},coverValue:function(t){var n=f({},t||{});e.deferSyncValue(function(){r.fields().forEach(function(t){var i=e.fieldCtx[t];if(i){var r=_(n,t);i.forEach(function(e){e.rule.value=r?n[t]:void 0}),delete n[t]}}),T(e.appendData,n)})},setValue:function(t){var n=t;arguments.length>=2&&(n=s({},t,arguments[1])),e.deferSyncValue(function(){Object.keys(n).forEach(function(t){var i=e.fieldCtx[t];if(!i)return e.appendData[t]=n[t];i.forEach(function(e){e.rule.value=n[t]})})})},removeField:function(t){var n=e.getCtx(t);return e.deferSyncValue(function(){e.getCtxs(t).forEach(function(e){e.rm()})},!0),n?n.origin:void 0},removeRule:function(e){var t=e&&de(e);if(t)return t.rm(),t.origin},destroy:function(){e.vm.$el.parentNode&&e.vm.$el.parentNode.removeChild(e.vm.$el),e.vm.$destroy()},fields:function(){return e.fields()},append:function(t,n,i){var r,o=e.sort.length-1,a=e.getCtx(n);a?i?(r=a.rule.children,o=a.rule.children.length-1):(o=a.root.indexOf(a.origin),r=a.root):r=e.rules,r.splice(o+1,0,t)},prepend:function(t,n,i){var r,o=0,a=e.getCtx(n);a?i?r=a.rule.children:(o=a.root.indexOf(a.origin),r=a.root):r=e.rules,r.splice(o,0,t)},hidden:function(t,i){n(i,"hidden",!!t),e.refresh()},hiddenStatus:function(t){var n=e.getCtx(t);if(n)return!!n.rule.hidden},display:function(t,i){n(i,"display",!!t),e.refresh()},displayStatus:function(t){var n=e.getCtx(t);if(n)return!!n.rule.display},disabled:function(n,i){t(i).forEach(function(t){e.getCtxs(t).forEach(function(e){e.rule.props&&F(e.rule.props,"disabled",!!n)})}),e.refresh()},all:function(t){return Object.keys(e.ctxs).map(function(n){var i=e.ctxs[n];return t?i.origin:i.rule})},model:function(t){return e.fields().reduce(function(n,i){var r=e.fieldCtx[i][0];return n[i]=t?r.origin:r.rule,n},{})},component:function(t){return Object.keys(e.nameCtx).reduce(function(n,i){var r=e.nameCtx[i].map(function(e){return t?e.origin:e.rule});return n[i]=1===r.length?r[0]:r,n},{})},bind:function(){return r.form},reload:function(t){e.reloadRule(t)},updateOptions:function(t){e.fc.updateOptions(t),r.refresh()},onSubmit:function(e){r.updateOptions({onSubmit:e})},sync:function(t){if(Array.isArray(t))t.forEach(function(e){return r.sync(e)});else{var n=O.Object(t)?de(t):e.getCtxs(t);n&&((n=Array.isArray(n)?n:[n]).forEach(function(t){if(!t.deleted){var n=e.subForm[t.id];n&&(Array.isArray(n)?n.forEach(function(e){e.refresh()}):n&&n.refresh()),e.$render.clearCache(t)}}),e.refresh())}},refresh:function(){i().forEach(function(e){e.refresh()}),e.$render.clearCacheAll(),e.refresh()},refreshOptions:function(){e.$manager.updateOptions(e.options),r.refresh()},hideForm:function(t){F(e.vm,"isShow",!t)},changeStatus:function(){return e.changeStatus},clearChangeStatus:function(){e.changeStatus=!1},updateRule:function(t,n){e.getCtxs(t).forEach(function(e){T(e.rule,n)})},updateRules:function(e){Object.keys(e).forEach(function(t){r.updateRule(t,e[t])})},mergeRule:function(t,n){e.getCtxs(t).forEach(function(e){se(e.rule,n)})},mergeRules:function(e){Object.keys(e).forEach(function(t){r.mergeRule(t,e[t])})},getRule:function(t,n){var i=e.getCtx(t);if(i)return n?i.origin:i.rule},setEffect:function(t,n,i){var r=e.getCtx(t);r&&n&&("$"===n[0]&&(n=n.substr(1)),_(r.rule,"$"+n)&&F(r.rule,"$"+n,i),_(r.rule,"effect")||F(r.rule,"effect",{}),F(r.rule.effect,n,i))},clearEffectData:function(t,n){var i=e.getCtx(t);i&&(n&&"$"===n[0]&&(n=n.substr(1)),i.clearEffectData(n),r.sync(t))},updateValidate:function(e,t,i){i?r.mergeRule(e,{validate:t}):n(e,"validate",t)},updateValidates:function(e,t){Object.keys(e).forEach(function(n){r.updateValidate(n,e[n],t)})},refreshValidate:function(){e.vm.validate={},r.refresh()},resetFields:function(n){t(n).forEach(function(t){e.getCtxs(t).forEach(function(t){e.$render.clearCache(t),t.rule.value=ke(t.defaultValue)})})},method:function(e,t){var n=r.el(e);if(!n||!n[t])throw new Error(G("err","".concat(t,"方法不存在")));return function(){return n[t].apply(n,arguments)}},exec:function(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];return pe(function(){return r.method(e,t).apply(void 0,i)})},toJson:function(e){return ne(r.rule,e)},trigger:function(e,t){for(var n=r.el(e),i=arguments.length,o=new Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];n&&n.$emit.apply(n,[t].concat(o))},el:function(t){var n=e.getCtx(t);if(n)return n.el||e.vm.$refs[n.ref]},closeModal:function(e){var t=r.el(e);t&&t.$emit&&t.$emit("close-modal")},getSubForm:function(t){var n=e.getCtx(t);return n?e.subForm[n.id]:void 0},nextTick:function(t){e.bus.$once("next-tick",t),e.refresh()},nextRefresh:function(t){e.nextRefresh(),t&&pe(t)},emit:function(t){for(var n,i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];(n=e.vm).$emit.apply(n,[t].concat(r))},deferSyncValue:function(t,n){e.deferSyncValue(t,n)},helper:{tidyFields:t,props:n}};return["on","once","off","set"].forEach(function(t){r[t]=function(){var n;(n=e.vm)["$".concat(t)].apply(n,arguments)}}),r.changeValue=r.changeField=r.setValue,r}(this),this)}function Ne(e){var t=e.responseText||e.response;if(!t)return t;try{return JSON.parse(t)}catch(e){return t}}function Me(e){if("undefined"!=typeof XMLHttpRequest){var t,n=new XMLHttpRequest,i=e.action;n.onerror=function(t){e.onError(t)},n.onload=function(){if(n.status<200||n.status>=300)return e.onError(function(e,t,n){var i="fail to ".concat(e," ").concat(n.status,"'"),r=new Error(i);return r.status=n.status,r.url=e,r}(i,0,n),Ne(n));e.onSuccess(Ne(n))},n.open(e.method||"get",i,!0),e.data&&("json"!==(e.dataType||"").toLowerCase()?(t=new FormData,Object.keys(e.data).map(function(n){t.append(n,e.data[n])})):(t=JSON.stringify(e.data),n.setRequestHeader("content-type","application/json"))),e.withCredentials&&"withCredentials"in n&&(n.withCredentials=!0);var r=e.headers||{};Object.keys(r).forEach(function(e){null!==r[e]&&n.setRequestHeader(e,r[e])}),n.send(t)}}T(Le.prototype,{initData:function(e){T(this,{ctxs:{},fieldCtx:{},nameCtx:{},sort:[],rules:e})},init:function(){this.appendData=f(f(f({},this.fc.options.formData||{}),this.vm.value||{}),this.appendData),this.useProvider(),this.usePage(),this.loadRule(),this.$manager.__init(),this.vm.$set(this.vm,"formData",this.formData)}}),function(e){T(e.prototype,{parseInjectEvent:function(e,t){var n=e.inject||this.options.injectEvent;return this.parseEventLst(e,t,n)},parseEventLst:function(e,t,n,i){var r=this;return Object.keys(t).forEach(function(o){var a=r.parseEvent(e,t[o],n,i);a&&(t[o]=a)}),t},parseEvent:function(e,t,n,i){if(O.Function(t)&&(!1!==n&&!O.Undef(n)||t.__inject))return this.inject(e,t,n);if(!i&&Array.isArray(t)&&t[0]&&(O.String(t[0])||O.Function(t[0])))return this.parseEventLst(e,t,n,!0);if(O.String(t)){var r=re(t);if(r&&t!==r)return r.__inject?this.parseEvent(e,r,n,!0):r}},parseEmit:function(e,t){var n=this,i={},r=e.rule,o=r.emitPrefix,a=r.field,u=r.name,c=r.inject,s=r[t?"emit":"nativeEmit"]||[];if(O.trueArray(s)){var l=o||a||u;l&&(t||(l="native-".concat(l)),s.forEach(function(e){if(e){var t;O.Object(e)&&(t=e.inject,e=e.name);var o=_e("".concat(l,"-").concat(e)),a=function(){for(var e,t,i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];(e=n.vm).$emit.apply(e,[o].concat(r)),(t=n.vm).$emit.apply(t,["emit-event",o].concat(r))};if(a.__emit=!0,t||!1!==c){var u=t||c||n.options.injectEvent;i[e]=O.Undef(u)?a:n.inject(r,a,u)}else i[e]=a}}))}return e.computed[t?"on":"nativeOn"]=i,i},getInjectData:function(e,t){var n=this.vm.$options.propsData,i=n.option,r=n.rule;return{api:this.api,$f:this.api,rule:r,self:e.__origin__,option:i,inject:t}},inject:function(e,t,n){if(t.__origin){if(this.watching&&!this.loading)return t;t=t.__origin}var i=this,r=function(){for(var r=i.getInjectData(e,n),o=arguments.length,a=new Array(o),u=0;u<o;u++)a[u]=arguments[u];return r.args=[].concat(a),a.unshift(r),t.apply(this,a)};return r.__origin=t,r.__json=t.__json,r}})}(Le),function(e){T(e.prototype,{usePage:function(){var e=this,t=this.options.page;if(t){var n,i=25,r=(n=this.rules).length<31?31:Math.ceil(n.length/3);O.Object(t)&&(t.first&&(i=parseInt(t.first,10)||i),t.limit&&(r=parseInt(t.limit,10)||r)),T(this,{first:i,limit:r,pageEnd:this.rules.length<=i}),this.bus.$on("page-end",function(){return e.vm.$emit("page-end",e.api)}),this.pageLoad()}},pageLoad:function(){var e=this;this.vm.$on(Re,function t(){e.pageEnd?(e.vm.$off(Re,t),e.bus.$emit("page-end")):(e.first+=e.limit,e.pageEnd=e.rules.length<=e.first,e.loadRule(),e.refresh())})}})}(Le),function(e){T(e.prototype,{clearNextTick:function(){this.nextTick&&clearTimeout(this.nextTick),this.nextTick=null},bindNextTick:function(e){var t=this;this.clearNextTick(),this.nextTick=setTimeout(function(){e(),t.nextTick=null},10)},render:function(){return++this.loadedId,this.vm.unique>0?this.$render.render():(this.vm.unique=1,[])}})}(Le),function(e){T(e.prototype,{nextRefresh:function(e){var t=this,n=this.loadedId;this.vm.$nextTick(function(){n===t.loadedId&&(e?e():t.refresh())})},parseRule:function(e){var t=this,n=le(e);return Object.defineProperties(n,{__origin__:ae(e,!0)}),function(e){var t={props:{},on:{},options:[],children:[],effect:{},hidden:!1,display:!0,value:void 0};Object.keys(t).forEach(function(n){_(e,n)||F(e,n,t[n])})}(n),this.appendValue(n),n.options=Array.isArray(n.options)?n.options:[],[n,n.prefix,n.suffix].forEach(function(e){e&&t.loadFn(e,n)}),this.loadCtrl(n),n.update&&(n.update=re(n.update)),n},loadFn:function(e,t){var n=this;["on","props","nativeOn","deep"].forEach(function(i){e[i]&&n.parseInjectEvent(t,e[i])})},loadCtrl:function(e){e.control&&e.control.forEach(function(e){e.handle&&(e.handle=re(e.handle))})},syncProp:function(e){var t=this,n=e.rule;O.trueArray(n.sync)&&U([{on:n.sync.reduce(function(e,i){return e["update:".concat(i)]=function(e){n.props[i]=e,t.vm.$emit("sync",i,e,n,t.fapi)},e},{})}],e.computed)},loadRule:function(){var e=this;this.cycleLoad=!1,this.loading=!0,this.pageEnd&&this.bus.$emit("load-start"),this.deferSyncValue(function(){if(e._loadRule(e.rules),e.loading=!1,e.cycleLoad&&e.pageEnd)return e.loadRule();e.pageEnd&&e.bus.$emit("load-end"),e.vm._renderRule(),e.$render.initOrgChildren(),e.syncForm()})},loadChildren:function(e,t){if(this.cycleLoad=!1,this.loading=!0,this.bus.$emit("load-start"),this._loadRule(e,t),this.loading=!1,this.cycleLoad)return this.loadRule();this.bus.$emit("load-end"),this.syncForm(),this.$render.clearCache(t)},_loadRule:function(e,t){var n=this,i=function(e,t){O.trueArray(e)&&n._loadRule(e,t)};e.map(function(r,o){if((!t||O.Object(r))&&(n.pageEnd||t||!(o>=n.first))){if(r.__fc__&&r.__fc__.root===e&&n.ctxs[r.__fc__.id])return i(r.__fc__.rule.children,r.__fc__),r.__fc__;var a,u=le(r),c=function(){return!(!u.field||!n.fieldCtx[u.field]||n.fieldCtx[u.field][0]===r.__fc__)};n.ruleEffect(u,"init",{repeat:c()}),c()&&n.vm.$emit("repeat-field",r,n.api);var s=!1,l=!!r.__fc__,f=u.value;if(l){f=(a=r.__fc__).defaultValue;var d=!a.check(n);if(a.deleted){if(d){if(Ae(a))return;a.update(n)}}else if(d){if(Ae(a))return;e[o]=r=r._clone?r._clone():ue(r),a=null,s=!0}}if(a)a.originType!==a.rule.type&&(a.updateType(),n.bindParser(a)),n.appendValue(a.rule);else{var p=n.parseRule(r);a=new Fe(n,p,l?f:p.value),n.bindParser(a)}if([!1,!0].forEach(function(e){return n.parseEmit(a,e)}),n.syncProp(a),a.parent=t||null,a.root=e,n.setCtx(a),!s&&!l&&n.effect(a,"load"),!1===a.parser.loadChildren||i(a.rule.children,a),!t){var h=function t(i){var r=e[i-1];if(!r||!r.__fc__)return i>0?t(i-1):-1;var o=n.sort.indexOf(r.__fc__.id);return o>-1?o:t(i-1)}(o);h>-1||!o?n.sort.splice(h+1,0,a.id):n.sort.push(a.id)}var m=a.rule;return a.updated||(a.updated=!0,O.Function(m.update)&&n.bus.$once("load-end",function(){n.refreshUpdate(a,m.value,"init")}),n.effect(a,"loaded")),a.input&&Object.defineProperty(m,"value",n.valueHandle(a)),n.refreshControl(a)&&(n.cycleLoad=!0),a}})},refreshControl:function(e){return e.input&&e.rule.control&&this.useCtrl(e)},useCtrl:function(e){var t=this,n=function(e){var t=e.rule.control||[];return O.Object(t)?[t]:t}(e),i=[],r=this.api;if(!n.length)return!1;for(var o=function(t){var o=n[t],a=o.handle||(Ie[o.condition||"=="]||Ie["=="])(o.value);if(!O.trueArray(o.rule))return"continue";var u=f(f({},o),{},{valid:pe(function(){return a(e.rule.value,r)}),ctrl:Ve(e,o.rule),isHidden:O.String(o.rule[0])});if(u.valid&&u.ctrl||!u.valid&&!u.ctrl&&!u.isHidden)return"continue";i.push(u)},a=0;a<n.length;a++)o(a);if(!i.length)return!1;var u=[],c=!1;return this.deferSyncValue(function(){i.reverse().forEach(function(n){var i=n.isHidden,o=n.valid,a=n.rule,s=n.prepend,l=n.append,f=n.child,d=n.ctrl,p=n.method;if(i)return o?e.ctrlRule.push({__ctrl:!0,children:a,valid:o}):e.ctrlRule.splice(e.ctrlRule.indexOf(d),1),void u[o?"push":"unshift"](function(){"disabled"===p?t.api.disabled(!o,a):"display"===p?t.api.display(o,a):"required"===p?(a.forEach(function(e){t.api.setEffect(e,"required",o)}),o||t.api.clearValidateState(a)):t.api.hidden(!o,a)});if(o){c=!0;var h={type:"fcFragment",native:!0,__ctrl:!0,children:a};e.ctrlRule.push(h),t.bus.$once("load-start",function(){s?r.prepend(h,s,f):l||f?r.append(h,l||e.id,f):e.root.splice(e.root.indexOf(e.origin)+1,0,h)})}else{e.ctrlRule.splice(e.ctrlRule.indexOf(d),1);var m=de(d);m&&m.rm()}})}),u.length&&this.vm.$nextTick(function(){u.forEach(function(e){return e()})}),this.vm.$emit("control",e.origin,this.api),this.effect(e,"control"),c},reloadRule:function(e){return this._reloadRule(e)},_reloadRule:function(e){var t=this;e||(e=this.rules);var n=f({},this.ctxs);this.clearNextTick(),this.$render.clearOrgChildren(),this.initData(e),this.fc.rules=e,this.deferSyncValue(function(){t.bus.$once("load-end",function(){Object.keys(n).filter(function(e){return void 0===t.ctxs[e]}).forEach(function(e){return t.rmCtx(n[e])}),t.$render.clearCacheAll()}),t.reloading=!0,t.loadRule(),t.reloading=!1,t.refresh(),t.vm.$emit("reloading",t.api)}),this.bus.$off("next-tick",this.nextReload),this.bus.$once("next-tick",this.nextReload),this.vm.$emit("update",this.api)},refresh:function(){this.vm._refresh()}})}(Le),function(e){T(e.prototype,{getValue:function(e){return O.Undef(e.cacheValue)&&(e.cacheValue=e.parser.toValue(this.getFormData(e),e)),e.cacheValue},setValue:function(e,t,n,i){e.deleted||(e.cacheValue=t,this.changeStatus=!0,this.nextRefresh(),this.$render.clearCache(e),this.setFormData(e,n),this.syncValue(),this.valueChange(e,t),this.vm.$emit("change",e.field,t,e.origin,this.api,i||!1),this.effect(e,"value"))},onInput:function(e,t){var n;e.input&&(this.isQuote(e,n=e.parser.toValue(t,e))||this.isChange(e,n))&&this.setValue(e,n,t)},setFormData:function(e,t){F(this.formData,e.id,null===t?void 0:t)},getFormData:function(e){return this.formData[e.id]},validate:function(){var e=this;return Te(this.vm.validate),this.fields().forEach(function(t){e.fieldCtx[t].forEach(function(t){e.vm.validate[t.id]=$(t.rule.validate)})}),this.vm.validate},syncForm:function(){var e=this;Te(this.form),Object.defineProperties(this.form,this.fields().reduce(function(t,n){var i=e.getFieldCtx(n),r=e.valueHandle(i);return r.configurable=!0,t[n]=r,t},this.options.appendValue?Object.keys(this.appendData).reduce(function(t,n){return t[n]={enumerable:!0,configurable:!0,get:function(){return e.appendData[n]},set:function(t){e.appendData[n]=t}},t},{}):{})),this.syncValue()},valueHandle:function(e){var t=this;return{enumerable:!0,get:function(){return t.getValue(e)},set:function(n){t.isChange(e,n)&&t.setValue(e,n,e.parser.toFormValue(n,e),!0)}}},appendValue:function(e){e.field&&_(this.appendData,e.field)&&(e.value=this.appendData[e.field],delete this.appendData[e.field])},addSubForm:function(e,t){this.subForm[e.id]=t},deferSyncValue:function(e,t){this.deferSyncFn||(this.deferSyncFn=e),this.deferSyncFn.sync||(this.deferSyncFn.sync=t),pe(e),this.deferSyncFn===e&&(this.deferSyncFn=null,e.sync&&this.syncValue())},syncValue:function(){if(this.deferSyncFn)return this.deferSyncFn.sync=!0;this.vm._updateValue(f(f({},this.options.appendValue?this.appendData:{}),this.form))},isChange:function(e,t){return JSON.stringify(e.rule.value,Pe)!==JSON.stringify(null===t?void 0:t,Pe)},isQuote:function(e,t){return(O.Object(t)||Array.isArray(t))&&t===e.rule.value},refreshUpdate:function(e,t,n){var i=this;if(O.Function(e.rule.update)){var r=pe(function(){return e.rule.update(t,e.origin,i.api,{origin:n||"change"})});if(void 0===r)return;e.rule.hidden=!0===r}},valueChange:function(e,t){this.refreshRule(e,t),this.bus.$emit("change-"+e.field,t)},refreshRule:function(e,t,n){this.refreshControl(e)&&(this.$render.clearCacheAll(),this.loadRule(),this.vm.$emit("update",this.api),this.refresh()),this.refreshUpdate(e,t,n)},appendLink:function(e){var t=this,n=e.rule.link;O.trueArray(n)&&n.forEach(function(n){var i=function(){return t.refreshRule(e,e.rule.value,"link")};t.bus.$on("change-"+n,i),e.linkOn.push(function(){return t.bus.$off("change-"+n,i)})})},fields:function(){return Object.keys(this.fieldCtx)}})}(Le),function(e){T(e.prototype,{getCtx:function(e){return this.getFieldCtx(e)||this.getNameCtx(e)[0]||this.ctxs[e]},getCtxs:function(e){return this.fieldCtx[e]||this.nameCtx[e]||(this.ctxs[e]?[this.ctxs[e]]:[])},setIdCtx:function(e,t,n){var i="".concat(n,"Ctx");this[i][t]?this[i][t].push(e):this[i][t]=[e]},rmIdCtx:function(e,t,n){var i="".concat(n,"Ctx"),r=this[i][t];if(!r)return!1;var o=r.splice(r.indexOf(e)>>>0,1).length>0;return r.length||delete this[i][t],o},getFieldCtx:function(e){return(this.fieldCtx[e]||[])[0]},getNameCtx:function(e){return this.nameCtx[e]||[]},setCtx:function(e){var t=e.id,n=e.field,i=e.name,r=e.rule;this.ctxs[t]=e,i&&this.setIdCtx(e,i,"name"),e.input&&(this.setIdCtx(e,n,"field"),this.setFormData(e,e.parser.toFormValue(r.value,e)),this.isMounted&&!this.reloading&&this.vm.$emit("change",e.field,r.value,e.origin,this.api))},getParser:function(e){var t=this.fc.parsers;return t[e.originType]||t[xe(e.type)]||t[e.trueType]||Be},bindParser:function(e){e.setParser(this.getParser(e))},getType:function(e){var t=this.fc.CreateNode.aliasMap,n=t[e]||t[xe(e)]||e;return xe(n)},noWatch:function(e){this.noWatchFn||(this.noWatchFn=e),pe(e),this.noWatchFn===e&&(this.noWatchFn=null)},watchCtx:function(e){var t=this,n=this.vm;Object.keys(e.rule).filter(function(e){return"_"!==e[0]&&"$"!==e[0]&&-1===De.indexOf(e)}).forEach(function(i){var r="children"===i;e.watch.push(n.$watch(function(){return e.rule[i]},function(n,o){if(!(t.loading||t.noWatchFn||t.reloading)){if(r&&!1===e.parser.loadChildren)return t.$render.clearCache(e),void t.nextRefresh();if(t.watching=!0,"link"!==i){if(["props","on","nativeOn","deep"].indexOf(i)>-1)t.parseInjectEvent(e.rule,n||{}),"props"===i&&e.input&&t.setFormData(e,e.parser.toFormValue(e.rule.value,e));else if(["emit","nativeEmit"].indexOf(i)>-1)t.parseEmit(e,"emit"===i);else if(["prefix","suffix"].indexOf(i)>-1)n&&t.loadFn(n,e.rule);else if("type"===i)e.updateType(),t.bindParser(e);else if("children"===i){var a=O.trueArray(n);t.deferSyncValue(function(){n!==o&&(t.rmSub(o,e),t.$render.initOrgChildren()),a&&t.loadChildren(n,e),t.vm.$emit("update",t.api)})}t.$render.clearCache(e),t.refresh(),t.watching=!1}else e.link()}},{deep:!r,sync:r}))}),this.watchEffect(e)},rmSub:function(e,t){var n=this;O.trueArray(e)&&e.forEach(function(e){e&&e.__fc__&&e.__fc__.parent===t&&n.rmCtx(e.__fc__)})},rmCtx:function(e){var t=this;if(!e.deleted){var n=e.id,i=e.field,r=e.input,o=e.name;e.input&&Object.defineProperty(e.rule,"value",{value:e.rule.value,writable:!0}),I(this.ctxs,n),I(this.$render.tempList,n),I(this.$render.orgChildren,n),I(this.vm.ctxInject,n),I(this.formData,n),I(this.subForm,n),I(e,"cacheValue"),r&&this.rmIdCtx(e,i,"field"),o&&this.rmIdCtx(e,o,"name"),r&&!_(this.fieldCtx,i)&&I(this.form,i),this.deferSyncValue(function(){t.reloading||(!1!==e.parser.loadChildren&&O.trueArray(e.rule.children)&&e.rule.children.forEach(function(e){return e.__fc__&&t.rmCtx(e.__fc__)}),e.root===t.rules&&t.vm._renderRule())},r);var a=this.sort.indexOf(n);return a>-1&&this.sort.splice(a,1),this.$render.clearCache(e),e.delete(),this.effect(e,"deleted"),r&&!this.fieldCtx[i]&&this.vm.$emit("removeField",i,e.rule,this.api),e.rule.__ctrl||this.vm.$emit("removeRule",e.rule,this.api),e}}})}(Le),function(e){T(e.prototype,{mounted:function(){var e=this,t=function(){e.isMounted=!0,e.lifecycle("mounted")};this.pageEnd?t():this.bus.$once("page-end",t)},lifecycle:function(e){var t=this,n=this.options[e];O.Function(n)&&pe(function(){return n(t.api)}),this.vm.$emit(e,this.api)}})}(Le),function(e){T(e.prototype,{useProvider:function(){var e=this,t=this.fc.providers;Object.keys(t).forEach(function(n){var i,r=t[n];O.Function(r)&&(r=r(e.fc)),r._c=(i=r.components,Array.isArray(i)?i.filter(function(e){return"*"!==e}).filter(function(e,t,n){return n.indexOf(e,0)===t}):!!O.String(i)&&[i]),e.onEffect(r),e.providers[n]=r})},onEffect:function(e){var t=this,n=[];(e._c||["*"]).forEach(function(i){var r="*"===i?"*":t.getType(i);n.indexOf(r)>-1||(n.push(r),t.bus.$on("p:".concat(e.name,":").concat(r,":").concat(e.input?1:0),function(t,n){e[t]&&e[t].apply(e,v(n))}))}),e._used=n},watchEffect:function(e){var t=this,n=this.vm,i={required:function(){var t,n;return(_(e.rule,"$required")?e.rule.$required:null===(t=e.rule)||void 0===t?void 0:null===(n=t.effect)||void 0===n?void 0:n.required)||!1}};Object.keys(e.rule.effect||{}).forEach(function(t){i[t]=function(){return e.rule.effect[t]}}),Object.keys(e.rule).forEach(function(t){"$"===t[0]&&(i[t.substr(1)]=function(){return e.rule[t]})}),Object.keys(i||{}).forEach(function(r){e.watch.push(n.$watch(i[r],function(n){t.effect(e,"watch",s({},r,n))},{deep:!0}))})},ruleEffect:function(e,t,n){this.emitEffect({rule:e,input:!!e.field,type:this.getType(e.type)},t,n)},effect:function(e,t,n){this.emitEffect({rule:e.rule,input:e.input,type:e.trueType,ctx:e,custom:n},t)},getEffect:function(e,t){return _(e,"$"+t)?e["$"+t]:_(e,"effect")&&_(e.effect,t)?e.effect[t]:void 0},emitEffect:function(e,t,n){var i=this,r=e.ctx,o=e.rule,a=e.input,u=e.type,c=e.custom;if(u&&"fcFragment"!==u){var s=c||Object.keys(o).reduce(function(e,t){return"$"===t[0]&&(e[t.substr(1)]=o[t]),e},f({},o.effect||{}));Object.keys(s).forEach(function(e){var c=i.providers[e];if(c&&(!c.input||a)){var l;if(c._c){if(!(c._used.indexOf(u)>-1))return;l=u}else l="*";var d=f({value:s[e],getValue:function(){return i.getEffect(o,e)}},n||{});r&&(d.getProp=function(){return r.effectData(e)},d.clearProp=function(){return r.clearEffectData(e)},d.mergeProp=function(e){return se(d.getProp(),[e])}),i.bus.$emit("p:".concat(e,":").concat(l,":").concat(c.input?1:0),t,[d,o,i.api])}})}}})}(Le);var qe={name:"fcFragment",functional:!0,props:["vnode"],render:function(e,t){return t.props.vnode?t.props.vnode:t.children}};function He(){var e={};function n(e){e&&this.setVm(e)}return T(n.prototype,{setVm:function(e){this.vm=e,this.$h=e.$createElement},make:function(e,n,i){return t.config.isReservedTag(e)&&n.nativeOn&&delete n.nativeOn,this.makeComponent(e,n,i)},makeComponent:function(e,t,n){var i,r=this.$h(e,(i=t,O.String(i)?{domProps:{innerHTML:i}}:i),n||[]);return r.context=this.vm,r},aliasMap:e}),T(n,{aliasMap:e,alias:function(t,n){e[t]=n},use:function(e){Object.keys(e).forEach(function(t){var i=_e(t),r=Oe(t).toLocaleLowerCase(),o=e[t];[t,i,r].forEach(function(e){n.alias(t,o),n.prototype[e]=function(e,t){return this.make(o,e,t)}})})}}),n}function Ue(e){var t=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(n,ze);var t=m(n);function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),t.apply(this,arguments)}return n}();return Object.assign(t.prototype,e),t}function ze(e){T(this,{$handle:e,vm:e.vm,options:{},ref:"fcForm",mergeOptionsRule:{normal:["form","row","info","submitBtn","resetBtn"]}}),this.updateKey(),this.init()}T(ze.prototype,{__init:function(){var e=this;this.$render=this.$handle.$render,this.$r=function(){var t;return(t=e.$render).renderRule.apply(t,arguments)}},updateKey:function(){this.key=je()},init:function(){},update:function(){},beforeRender:function(){},form:function(){return this.vm.$refs[this.ref]},mergeOptions:function(e,t){var n=this;return U(e.map(function(e){return n.tidyOptions(e)}),t,this.mergeOptionsRule)},updateOptions:function(e){this.options=this.mergeOptions([e],this.getDefaultOptions()),this.update()},tidyOptions:function(e){return e},tidyRule:function(e){},mergeProp:function(e){},getDefaultOptions:function(){return{}},render:function(e){}});var Je={name:"componentValidate",load:function(e,t,n){var i=e.getValue();i?e.getProp().validate=[{validator:function(){var r=de(t);if(r){for(var o=arguments.length,a=new Array(o),u=0;u<o;u++)a[u]=arguments[u];return n.exec.apply(n,[r.id,!0===i?"formCreateValidate":i].concat(a,[{attr:e,rule:t,api:n}]))}}}]:(e.clearProp(),n.clearValidateState([t.field]))},watch:function(){Je.load.apply(Je,arguments)}},We={name:"required",load:function(e,t,n){var i=function(e){return O.Boolean(e)?{required:e}:O.String(e)?{message:e}:O.Undef(e)?{required:!1}:O.Function(e)?{validator:e}:O.Object(e)?e:{}}(e.getValue());if(!1===i.required)e.clearProp();else{var r=f({required:!0,validator:function(e,t,n){O.empty(t)?n(r.message):n()}},i);if(!r.message){var o=t.title||"";r.message=(("object"===c(o)?o.title:o)||"")+"不能为空"}e.getProp().validate=[r]}n.sync(t)},watch:function(){We.load.apply(We,arguments)}};var Ke={fetch:function(e){function t(t,n,i){var r=t.value;if(O.Function(r)&&(r=r(n,i)),!(r=function(e){return O.String(e)&&(e={action:e,to:"options"}),e}(r))||!r.action)return!1;r.to||(r.to="options");var o=r.onError,a=function(){if(!t.getValue())return t.clearProp(),i.sync(n),!0},u=function(e){void 0===e?(t.clearProp(),i.sync(n)):Se(t.getProp(),r.to,e)};return pe(function(){return e.create.fetch(f(f({},r),{},{onSuccess:function(e){if(!a()){var t=function(e){return e.data};O.Function(r.parse)&&(t=r.parse),u(t(e,n,i)),i.sync(n)}},onError:function(e){u(void 0),a()||(o||function(e){return X(e.message||"fetch fail "+r.action)})(e,n,i)}}),{inject:t,rule:n,api:i})}),!0}return{name:"fetch",loaded:function(){t.apply(void 0,arguments)},watch:function(e,n,i){t(e,n,i)||(e.clearProp(),i.sync(n))}}},required:We,componentValidate:Je},Ge={name:"html",loadChildren:!1,render:function(e,t){return t.prop.domProps||(t.prop.domProps={}),t.prop.domProps.innerHTML=e,t.vNode.make(t.prop.props.tag||"div",t.prop)},renderChildren:function(e){return Array.isArray(e.rule.children)?e.rule.children.filter(function(e){return O.String(e)}).join(""):""}},Xe="undefined"!=typeof window&&window.Vue?window.Vue:t;function Qe(){return function(e,t){var n;return 2===arguments.length?t=(n=arguments[1])[e]:n=arguments[2],{id:t,prop:n}}.apply(void 0,["name"].concat(Array.prototype.slice.call(arguments)))}function Ze(e){return e&&e.el?O.Element(e.el)?e.el:document.querySelector(e.el):window.document.body}function Ye(e,t){var n=new Xe({data:function(){return{rule:e,option:t||{}}},render:function(e){return e("FormCreate",{ref:"fc",props:this.$data})}});return n.$mount(),n}var et=1,tt={};function nt(e){var t,n,i,r,o=s({},qe.name,qe),a={},u={},c=f({},Ke),l=$e(),d={global:{}},p={},h=He();function m(e){var t=tt[e];return Array.isArray(t)?v(t):t}function y(){var e=Qe.apply(void 0,arguments);e.id&&e.prop&&(u[e.id]=e.prop)}function g(){var e=Qe.apply(void 0,arguments);e.id&&e.prop&&(c[e.id]=f(f({},e.prop),{},{name:e.id}))}function b(e){h.use(e)}function $(){var e=Qe.apply(void 0,arguments);if(e.id&&e.prop){var t=xe(e.id),n=e.prop,i=!0===n.merge?a[t]:void 0;a[t]=f(f({},i||Be),n),l[t]=he(t),n.maker&&T(l,n.maker)}}function k(e,t){var n;if(O.String(e)){if(n=xe(e),["form-create","formcreate"].indexOf(n)>-1)return x();if(void 0===t)return o[n]}else n=xe(e.name),t=e;n&&t&&(o[n]=t,t.formCreateParser&&$(n,t.formCreateParser))}function x(){return Xe.extend(N(S))}function C(){return Xe.extend(qe)}function _(e,t){return O.Function(e.install)?e.install(w,t):O.Function(e)&&e(w,t),this}function w(e,t,n){var i=Ye(e,t||{}),r=i.$refs.fc.formCreate;return r.$parent=n,Ze(r.options).appendChild(i.$el),r.api()}function j(t){var n=f({},e);return t?n.inherit={components:o,parsers:a,directives:u,providers:c,maker:l,data:p}:delete n.inherit,nt(n)}function S(t,n,i){T(this,{id:et++,vm:t,create:w,manager:Ue(e.manager),parsers:a,providers:c,rules:Array.isArray(n)?n:[],name:t.$options.propsData.name,inFor:t.$options.propsData.inFor,prop:{components:o,directives:u},CreateNode:h,bus:new Xe,unwatch:null,options:i||{},extendApi:e.extendApi||function(e){return e}}),this.init(),this.initOptions(this.options),this.name&&(this.inFor?(tt[this.name]||(tt[this.name]=[]),tt[this.name].push(this.api())):tt[this.name]=this.api())}function E(t){T(t,{version:e.version,ui:e.ui,data:p,maker:l,component:k,directive:y,register:g,$vnode:C,parser:$,use:_,factory:j,componentAlias:b,copyRule:ue,copyRules:ce,fetch:Me,$form:x,parseFn:re,parseJson:oe,toJson:ne,getApi:m,init:function(e){var t=Ye(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),n=t.$refs.fc.formCreate;return{mount:function(e){return e&&O.Element(e)&&(n.options.el=e),Ze(n.options).appendChild(t.$el),n.api()},remove:function(){t.$el.parentNode&&t.$el.parentNode.removeChild(t.$el)},destroy:function(){this.remove(),t.$destroy()},$f:n.api()}}})}if(t=e.attrs||{},n=t.key||[],i=t.array||[],r=t.normal||[],J.push.apply(J,v(n)),W.push.apply(W,v(i)),K.push.apply(K,v(r)),ve([].concat(v(n),v(i),v(r))),T(S.prototype,{init:function(){var e=this,t=this.vm,n=new Le(this);this.$handle=n,t.$f=n.api,t.$emit("input",n.api),t.$on("hook:created",function(){e.isSub()&&(e.unwatch=t.$watch(function(){return t.$pfc.option},function(){e.initOptions(e.options),t.$f.refresh()},{deep:!0}),e.initOptions(e.options)),e.created()}),t.$on("hook:mounted",function(){e.mounted()}),t.$on("hook:beforeDestroy",function(){if(t.destroyed=!0,e.unwatch&&e.unwatch(),n.reloadRule([]),e.name)if(e.inFor){var i=tt[e.name].indexOf(e.api());tt[e.name].splice(i,1)}else delete tt[e.name]}),t.$on("hook:updated",function(){n.bindNextTick(function(){return e.bus.$emit("next-tick",n.api)})})},isSub:function(){return this.vm.$pfc&&this.vm.extendOption},initOptions:function(e){this.options=f({formData:{},submitBtn:{},resetBtn:{}},A(d)),this.isSub()&&this.mergeOptions(this.options,this.vm.$pfc.$f.config||{},!0),this.updateOptions(e)},mergeOptions:function(e,t,n){return t=A(t),n&&["page","onSubmit","mounted","reload","formData","el"].forEach(function(e){delete t[e]}),t.global&&(e.global=function(e,t){return e?(Object.keys(t||{}).forEach(function(n){t[n]&&(e[n]=se(e[n]||{},t[n]))}),e):t}(e.global,t.global),delete t.global),this.$handle.$manager.mergeOptions([t],e),e},updateOptions:function(e){this.mergeOptions(this.options,e),this.$handle.$manager.updateOptions(this.options)},created:function(){this.$handle.init(),this.vm.$emit("created",this.api())},api:function(){return this.$handle.api},render:function(){return this.$handle.render()},mounted:function(){this.$handle.mounted()}}),E(w),T(w,{create:w,install:function(e,t){if(d=f(f({},d),t||{}),!0!==e._installedFormCreate){e._installedFormCreate=!0,Xe=e;var n=function(e){return w(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},this)};E(n),e.prototype.$formCreate=n,e.component("FormCreate",x()),e.component("FcFragment",C())}}}),h.use({fragment:"fcFragment"}),$(Ge),e.install&&w.use(e),e.inherit){var R=e.inherit;R.components&&T(o,R.components),R.parsers&&T(a,R.parsers),R.directives&&T(u,R.directives),R.providers&&T(c,R.providers),R.maker&&T(l,R.maker),R.data&&T(p,R.data)}return w}var it={date:"yyyy-MM-dd",month:"yyyy-MM",datetime:"yyyy-MM-dd HH:mm:ss",timerange:"HH:mm:ss",daterange:"yyyy-MM-dd",monthrange:"yyyy-MM",datetimerange:"yyyy-MM-dd HH:mm:ss",year:"yyyy"},rt={name:"datePicker",maker:["year","month","date","dates","week","datetime","datetimeRange","dateRange","monthRange"].reduce(function(e,t){return e[t]=he("datePicker",{type:t.toLowerCase()}),e},{}),mergeProp:function(e){var t=e.prop.props;t.valueFormat||(t.valueFormat=it[t.type]||it.date)}},ot={name:"hidden",maker:s({},"hidden",function(e,t){return he("hidden")("",e,t)}),render:function(){return[]}},at=[rt,ot,{name:"input",maker:function(){var e=["password","url","email","text","textarea"].reduce(function(e,t){return e[t]=he("input",{type:t}),e},{});return e.idate=he("input",{type:"date"}),e}(),mergeProp:function(e){var t=e.prop.props;t&&t.autosize&&t.autosize.minRows&&(t.rows=t.autosize.minRows||2)}},{name:"slider",maker:{sliderRange:he("slider",{range:!0})},toFormValue:function(e,t){var n=Array.isArray(e),i=t.prop.props,r=i.min||0;return!0===i.range?n?e:[r,parseFloat(e)||r]:n?parseFloat(e[0])||r:parseFloat(e)}},{name:"timePicker",maker:{time:he("timePicker",function(e){return e.props.isRange=!1}),timeRange:he("timePicker",function(e){return e.props.isRange=!0})},mergeProp:function(e){var t=e.prop.props;t.valueFormat||(t.valueFormat="HH:mm:ss")}},{name:"FcRow",render:function(e,t){return t.vNode.col({props:{span:24}},[t.vNode.row(t.prop,e)])}},{name:"select",toFormValue:function(e,t){return t.prop.props.multiple&&!Array.isArray(e)?$(e):e}}],ut={button:"elButton",icon:"i",slider:"elSlider",rate:"elRate",upload:"fcUpload",cascader:"elCascader",popover:"elPopover",tooltip:"elTooltip",colorPicker:"elColorPicker",timePicker:"elTimePicker",timeSelect:"elTimeSelect",datePicker:"elDatePicker",switch:"elSwitch",select:"fcSelect",checkbox:"fcCheckbox",radio:"fcRadio",inputNumber:"elInputNumber",number:"elInputNumber",input:"elInput",formItem:"elFormItem",form:"elForm",frame:"fcFrame",col:"elCol",row:"elRow",tree:"fcTree",autoComplete:"elAutocomplete",auto:"elAutocomplete",group:"fcGroup",object:"fcSubForm",subForm:"fcSubForm"};var ct=/[A-Z]/;function st(e,t){var n;_(e,t)&&(O.String(e[t])&&(e[t]=(s(n={},t,e[t]),s(n,"show",!0),n)))}function lt(e){return!1===e}var ft={validate:function(){var e=this.form();return e?e.validate():new Promise(function(e){return e()})},validateField:function(e){var t=this.form();return t?new Promise(function(n,i){t.validateField(e,function(e){e?i(e):n(null)})}):new Promise(function(e){return e()})},clearValidateState:function(e){var t=this.vm.$refs[e.wrapRef];t&&(t.validateMessage="",t.validateState="")},tidyOptions:function(e){return["submitBtn","resetBtn","row","info","wrap","col"].forEach(function(t){!function(e,t){_(e,t)&&!O.Object(e[t])&&(e[t]={show:!!e[t]})}(e,t)}),e},tidyRule:function(e){var t=e.prop;return st(t,"title"),st(t,"info"),t},mergeProp:function(e){var t=e.prop.props;e.prop=U([{attrs:Object.keys(t).reduce(function(e,n){var i,r;return i=n,r=t[n],ct.test(i)||!O.String(r)&&!O.Number(r)||(e[n]=t[n]),e},{}),info:this.options.info||{},wrap:this.options.wrap||{},col:this.options.col||{}},e.prop],{info:{trigger:"hover",placement:"top-start",icon:"el-icon-warning"},title:{},col:{span:24},wrap:{}},{normal:["title","info","col","wrap"]})},getDefaultOptions:function(){return{form:{inline:!1,labelPosition:"right",labelWidth:"125px",disabled:!1,size:void 0},row:{show:!0,gutter:0},submitBtn:{type:"primary",loading:!1,disabled:!1,innerText:"提交",show:!0,col:void 0,click:void 0},resetBtn:{type:"default",loading:!1,disabled:!1,icon:"el-icon-refresh",innerText:"重置",show:!1,col:void 0,click:void 0}}},update:function(){var e=this.options.form;this.rule={props:f({},e),nativeOn:{submit:function(e){e.preventDefault()}},class:[e.className,e.class,"form-create"],style:e.style,type:"form"}},beforeRender:function(){var e=this.key,t=this.ref,n=this.$handle;T(this.rule,{key:e,ref:t}),T(this.rule.props,{model:n.formData,rules:n.validate()})},render:function(e){return e.length&&e.push(this.makeFormBtn()),this.$r(this.rule,lt(this.options.row.show)?e:[this.makeRow(e)])},makeWrap:function(e,t){var n=e.prop,i="".concat(this.key).concat(e.key),r=n.col,o=this.isTitle(n),a=r.labelWidth||o?r.labelWidth:0,u=this.rule.props,c=u.inline,s=u.col,l=lt(n.wrap.show)?t:this.$r(U([n.wrap,{props:f(f({labelWidth:void 0===a?a:Oe(a),label:o?n.title.title:void 0},n.wrap||{}),{},{prop:e.id,rules:n.validate}),class:n.className,key:"".concat(i,"fi"),ref:e.wrapRef,type:"formItem"}]),[t,o?this.makeInfo(n,i):null]);return!0===c||lt(s)||lt(r.show)?l:this.makeCol(n,i,[l])},isTitle:function(e){if(!1===this.options.form.title)return!1;var t=e.title;return!(!t.title&&!t.native||lt(t.show))},makeInfo:function(e,t){var n=e.title,i=e.info,r="tooltip"===i.type,o=this.options.form,a=[(n.title||"")+(o.labelSuffix||o["label-suffix"]||"")];if(!lt(i.show)&&(i.info||i.native)&&!lt(i.icon)){var u={type:i.type||"popover",props:f({},i),key:"".concat(t,"pop"),slot:"label"};i.info&&!_(u.props,"content")&&(u.props.content=i.info),a["left"!==i.align?"unshift":"push"](this.$r(U([i,u]),[this.$r({type:"i",slot:r?"default":"reference",class:!0===i.icon?"el-icon-warning":i.icon,key:"".concat(t,"i")})]))}return this.$r(U([n,{props:n,slot:n.slot||"label",key:"".concat(t,"tit"),type:n.type||"span"}]),a)},makeCol:function(e,t,n){var i=e.col;return this.$r({class:i.class,type:"col",props:i||{span:24},key:"".concat(t,"col")},n)},makeRow:function(e){var t=this.options.row||{};return this.$r({type:"row",props:t,class:t.class,key:"".concat(this.key,"row")},e)},makeFormBtn:function(){var e=[];if(lt(this.options.submitBtn.show)||e.push(this.makeSubmitBtn()),lt(this.options.resetBtn.show)||e.push(this.makeResetBtn()),e.length){var t=this.$r({type:"formItem",key:"".concat(this.key,"fb")},e);return!0===this.rule.props.inline?t:this.$r({type:"col",props:{span:24},key:"".concat(this.key,"fc")},[t])}},makeResetBtn:function(){var e=this,t=this.options.resetBtn;return this.$r({type:"button",props:t,style:{width:t.width},on:{click:function(){var n=e.$handle.api;t.click?t.click(n):n.resetFields()}},key:"".concat(this.key,"b2")},[t.innerText])},makeSubmitBtn:function(){var e=this,t=this.options.submitBtn;return this.$r({type:"button",props:t,style:{width:t.width},on:{click:function(){var n=e.$handle.api;t.click?t.click(n):n.submit()}},key:"".concat(this.key,"b1")},[t.innerText])}},dt={};!function(e){["group","tree","switch","upload","autoComplete","checkbox","cascader","colorPicker","datePicker","frame","inputNumber","radio","rate"].forEach(function(t){e[t]=he(t)}),e.auto=e.autoComplete,e.number=e.inputNumber,e.color=e.colorPicker}(dt),function(e){e.selectMultiple=he("select",s({},"multiple",!0)),e.selectOne=he("select",s({},"multiple",!1))}(dt),function(e){var t={treeSelected:"selected",treeChecked:"checked"};Object.keys(t).reduce(function(e,n){return e[n]=he("tree",{type:t[n]}),e},e)}(dt),function(e){var t={image:["image",0],file:["file",0],uploadFileOne:["file",1],uploadImageOne:["image",1]};Object.keys(t).reduce(function(e,n){return e[n]=he("upload",function(e){return e.props({uploadType:t[n][0],maxLength:t[n][1]})}),e},e),e.uploadImage=e.image,e.uploadFile=e.file}(dt),function(e){var t={frameInputs:["input",0],frameFiles:["file",0],frameImages:["image",0],frameInputOne:["input",1],frameFileOne:["file",1],frameImageOne:["image",1]};Object.keys(t).reduce(function(e,n){return e[n]=he("frame",function(e){return e.props({type:t[n][0],maxLength:t[n][1]})}),e},e),e.frameInput=e.frameInputs,e.frameFile=e.frameFiles,e.frameImage=e.frameImages}(dt);function pt(e,t){return O.Boolean(e)?e={show:e}:O.Undef(e)||O.Object(e)||(e={show:t}),e}function ht(e,t){return T(e,{validate:function(n){return new Promise(function(i,r){var o=e.children,a=[t.$manager.validate()];o.forEach(function(e){a.push(e.validate())}),Promise.all(a).then(function(){i(!0),n&&n(!0)}).catch(function(i){r(i),n&&n(!1,i),t.vm.$emit("validate-fail",i,{api:e})})})},validateField:function(n,i){return new Promise(function(r,o){var a=t.getFieldCtx(n);if(a){var u=t.subForm[a.id],c=[t.$manager.validateField(a.id)];$(u).forEach(function(e){c.push(e.validate().catch(function(){return Promise.reject("子表单验证未通过")}))}),Promise.all(c).then(function(){r(null),i&&i(null)}).catch(function(r){o(r),i&&i(r),t.vm.$emit("validate-field-fail",r,{field:n,api:e})})}})},clearValidateState:function(n){var i=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.helper.tidyFields(n).forEach(function(e){r&&i.clearSubValidateState(e),t.getCtxs(e).forEach(function(e){t.$manager.clearValidateState(e)})})},clearSubValidateState:function(n){e.helper.tidyFields(n).forEach(function(e){t.getCtxs(e).forEach(function(e){var n=t.subForm[e.id];n&&(Array.isArray(n)?n.forEach(function(e){e.clearValidateState()}):n&&n.clearValidateState())})})},btn:{loading:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e.submitBtnProps({loading:!!t})},disabled:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e.submitBtnProps({disabled:!!t})},show:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e.submitBtnProps({show:!!t})}},resetBtn:{loading:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e.resetBtnProps({loading:!!t})},disabled:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e.resetBtnProps({disabled:!!t})},show:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e.resetBtnProps({show:!!t})}},submitBtnProps:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=pt(t.options.submitBtn,!0);T(i,n),t.options.submitBtn=i,e.refreshOptions()},resetBtnProps:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=pt(t.options.resetBtn,!1);T(i,n),t.options.resetBtn=i,e.refreshOptions()},submit:function(n,i){var r=arguments,o=this;e.validate(function(a){if(a){var u=e.formData();O.Function(n)?pe(function(){return n(u,o)}):(O.Function(t.options.onSubmit)&&pe(function(){return t.options.onSubmit(u,o)}),t.vm.$emit("submit",u,o))}else O.Function(i)&&pe(function(){return i.apply(void 0,[o].concat(v(r)))})})}}),e}function mt(e){e.componentAlias(ut),B.forEach(function(t){e.component(t.name,t)}),at.forEach(function(t){e.parser(t)}),Object.keys(dt).forEach(function(t){e.maker[t]=dt[t]})}k(".form-create .form-create .el-form-item {\n    margin-bottom: 22px;\n}\n\n.form-create .form-create .el-form-item .el-form-item {\n    margin-bottom: 0px;\n}\n");var vt=nt({ui:"".concat("element-ui"),version:"".concat("2.5.31"),manager:ft,extendApi:ht,install:mt,attrs:{normal:["col","wrap"],array:["className"],key:["title","info"]}});"undefined"!=typeof window&&(window.formCreate=vt,window.Vue&&vt.install(window.Vue));var yt=vt.maker;e.default=vt,e.maker=yt,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=form-create.min.js.map